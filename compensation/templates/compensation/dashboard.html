{% extends 'base.html' %}
{% load static %}

{% block title %}보상 관리 - OK금융그룹 e-HR{% endblock %}

{% block content %}
<!-- 브레드크럼 -->
<nav class="flex mb-4" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
            <a href="{% url 'home' %}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary dark:text-gray-400 dark:hover:text-white">
                <i class="fas fa-home mr-2"></i>
                홈
            </a>
        </li>
        <li>
            <div class="flex items-center">
                <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">보상 관리</span>
            </div>
        </li>
    </ol>
</nav>

<!-- 페이지 헤더 -->
<div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between">
    <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">스마트 보상관리 시스템</h1>
        <p class="text-gray-600 dark:text-gray-300">AI 예측 모델로 최적의 보상 전략을 설계하고 인재 유지율을 극대화합니다</p>
    </div>
    <div class="mt-4 md:mt-0 flex gap-3">
        <a href="#" class="btn btn-primary">
            <i class="fas fa-file-alt mr-2"></i>
            급여명세서
        </a>
        <a href="#" class="btn btn-ghost">
            <i class="fas fa-download mr-2"></i>
            리포트 다운로드
        </a>
    </div>
</div>

<!-- 통계 카드 섹션 -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-lg transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-primary to-primary-hover rounded-lg flex items-center justify-center">
                <i class="fas fa-users text-white text-xl"></i>
            </div>
            <span class="text-green-600 text-sm font-medium">+2.5%</span>
        </div>
        <div class="space-y-1">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{{ total_employees|default:"0" }}</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">전체 직원</p>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-lg transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-dollar-sign text-white text-xl"></i>
            </div>
            <span class="text-green-600 text-sm font-medium">+5.2%</span>
        </div>
        <div class="space-y-1">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{{ avg_salary|default:"5200" }}만원</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">평균 연봉</p>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-lg transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-award text-white text-xl"></i>
            </div>
            <span class="text-green-600 text-sm font-medium">+8.1%</span>
        </div>
        <div class="space-y-1">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{{ total_bonus|default:"15" }}억원</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">총 보너스</p>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-lg transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-percent text-white text-xl"></i>
            </div>
            <span class="text-green-600 text-sm font-medium">+1.2%</span>
        </div>
        <div class="space-y-1">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white">{{ salary_growth|default:"6.8" }}%</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">연봉 증가율</p>
        </div>
    </div>
</div>

<!-- 차트 섹션 -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">연봉 분포</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">직원별 연봉 분포 현황</p>
        </div>
        <div class="h-64">
            <canvas id="salaryDistributionChart" class="w-full h-full"></canvas>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">부서별 평균 연봉</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">부서별 평균 연봉 비교</p>
        </div>
        <div class="h-64">
            <canvas id="departmentSalaryChart" class="w-full h-full"></canvas>
        </div>
    </div>
</div>

<!-- 보상 구성 분석 -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">보상 구성 분석</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">기본급, 성과급, 복리후생비 구성 비율</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
                <div class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-lg">65%</span>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">기본급</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">고정 보상</p>
            </div>
            <div class="text-center">
                <div class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-lg">25%</span>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">성과급</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">변동 보상</p>
            </div>
            <div class="text-center">
                <div class="w-20 h-20 bg-yellow-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-white font-bold text-lg">10%</span>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-white mb-2">복리후생</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">간접 보상</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
        <div class="mb-6">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">최근 보상 이벤트</h2>
        </div>
        <div class="space-y-4">
            <div class="flex gap-3">
                <div class="w-3 h-3 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                <div class="flex-1">
                    <h3 class="font-medium text-gray-900 dark:text-white text-sm">연봉 인상</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">2024년 연봉 인상 완료</p>
                    <span class="text-xs text-gray-400">2024.01.15</span>
                </div>
            </div>
            <div class="flex gap-3">
                <div class="w-3 h-3 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
                <div class="flex-1">
                    <h3 class="font-medium text-gray-900 dark:text-white text-sm">성과급 지급</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">2023년 성과급 지급</p>
                    <span class="text-xs text-gray-400">2023.12.20</span>
                </div>
            </div>
            <div class="flex gap-3">
                <div class="w-3 h-3 bg-yellow-500 rounded-full mt-2 flex-shrink-0"></div>
                <div class="flex-1">
                    <h3 class="font-medium text-gray-900 dark:text-white text-sm">복리후생 개선</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">의료보험료 지원 확대</p>
                    <span class="text-xs text-gray-400">2023.11.10</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 상위 연봉자 테이블 -->
<div class="top-salaries mb-5">
    <div class="card">
        <div class="card-header">
            <h4 class="card-title">상위 연봉자</h4>
            <p class="card-subtitle">연봉 기준 상위 10명</p>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>순위</th>
                            <th>이름</th>
                            <th>부서</th>
                            <th>직급</th>
                            <th>연봉</th>
                            <th>성장레벨</th>
                            <th>변화</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for employee in top_salaries %}
                        <tr>
                            <td>
                                <span class="rank-badge rank-{{ forloop.counter }}">
                                    {{ forloop.counter }}
                                </span>
                            </td>
                            <td>
                                <div class="employee-info">
                                    <div class="employee-avatar">
                                        <i data-lucide="user" class="w-6 h-6"></i>
                                    </div>
                                    <div>
                                        <h6 class="employee-name">{{ employee.name }}</h6>
                                        <p class="employee-id">{{ employee.employee_id }}</p>
                                    </div>
                                </div>
                            </td>
                            <td>{{ employee.department }}</td>
                            <td>{{ employee.position }}</td>
                            <td>
                                <span class="salary-amount">{{ employee.salary|floatformat:0 }}만원</span>
                            </td>
                            <td>
                                <span class="badge badge-primary">Lv.{{ employee.growth_level }}</span>
                            </td>
                            <td>
                                <span class="change-indicator positive">
                                    <i data-lucide="trending-up" class="w-4 h-4"></i>
                                    +{{ employee.salary_change|floatformat:1 }}%
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 다크모드 지원을 위한 Chart.js 기본 설정
Chart.defaults.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim() || '#374151';
Chart.defaults.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color').trim() || '#E5E7EB';

const isDark = document.documentElement.classList.contains('dark');

// 연봉 분포 차트
const salaryCtx = document.getElementById('salaryDistributionChart').getContext('2d');
const salaryChart = new Chart(salaryCtx, {
    type: 'doughnut',
    data: {
        labels: ['3,000만원 미만', '3,000-5,000만원', '5,000-7,000만원', '7,000만원 이상'],
        datasets: [{
            data: [25, 35, 30, 10],
            backgroundColor: [
                '#FF6B00',
                '#4A90E2',
                '#7ED321',
                '#F59E0B'
            ],
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: isDark ? '#F3F4F6' : '#374151',
                    padding: 20,
                    usePointStyle: true
                }
            }
        }
    }
});

// 부서별 평균 연봉 차트
const deptCtx = document.getElementById('departmentSalaryChart').getContext('2d');
const deptChart = new Chart(deptCtx, {
    type: 'bar',
    data: {
        labels: ['IT개발', '마케팅', '영업', '인사', '재무'],
        datasets: [{
            label: '평균 연봉 (만원)',
            data: [5500, 4800, 5200, 4500, 5000],
            backgroundColor: '#FF6B00',
            borderRadius: 8
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: isDark ? '#374151' : '#E5E7EB'
                },
                ticks: {
                    color: isDark ? '#F3F4F6' : '#374151'
                }
            },
            x: {
                grid: {
                    display: false
                },
                ticks: {
                    color: isDark ? '#F3F4F6' : '#374151'
                }
            }
        }
    }
});

// 다크모드 전환 감지 및 차트 업데이트
const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (mutation.attributeName === 'class') {
            const isDarkMode = document.documentElement.classList.contains('dark');
            const textColor = isDarkMode ? '#F3F4F6' : '#374151';
            const gridColor = isDarkMode ? '#374151' : '#E5E7EB';
            
            // 차트 색상 업데이트
            [salaryChart, deptChart].forEach(chart => {
                if (chart.options.plugins?.legend?.labels) {
                    chart.options.plugins.legend.labels.color = textColor;
                }
                if (chart.options.scales?.y?.ticks) {
                    chart.options.scales.y.ticks.color = textColor;
                    chart.options.scales.y.grid.color = gridColor;
                }
                if (chart.options.scales?.x?.ticks) {
                    chart.options.scales.x.ticks.color = textColor;
                }
                chart.update('none');
            });
        }
    });
});

observer.observe(document.documentElement, { attributes: true });
</script>
{% endblock %} 