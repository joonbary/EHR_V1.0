<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIRISS 경영진 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fa; }
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- 헤더 -->
        <div class="dashboard-header">
            <h1>AIRISS 경영진 대시보드</h1>
            <p>AI 기반 직원 성과/역량 분석 시스템</p>
            <small>최종 업데이트: {{ last_updated|date:"Y-m-d H:i" }}</small>
        </div>

        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <h6 class="text-muted">전체 직원 수</h6>
                    <h2>{{ total_employees|default:0 }}</h2>
                    <small class="text-success">+5% 전월 대비</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h6 class="text-muted">평균 AI 점수</h6>
                    <h2>85.3</h2>
                    <small class="text-success">+3.2점 상승</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h6 class="text-muted">우수 인재</h6>
                    <h2>15</h2>
                    <small class="text-muted">S등급</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <h6 class="text-muted">관리 필요</h6>
                    <h2>10</h2>
                    <small class="text-danger">즉시 조치</small>
                </div>
            </div>
        </div>

        <!-- 부서별 현황 -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">부서별 인원 현황</h5>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>부서</th>
                            <th>인원</th>
                            <th>평균 점수</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dept in dept_stats %}
                        <tr>
                            <td>{{ dept.department }}</td>
                            <td>{{ dept.count }}</td>
                            <td>{{ dept.avg_score|floatformat:1 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">데이터 없음</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 액션 버튼 -->
        <div class="d-flex gap-2">
            <a href="{% url 'airiss:employee_analysis_all' %}" class="btn btn-primary">전직원 분석 보기</a>
            <a href="{% url 'airiss:msa_integration' %}" class="btn btn-outline-primary">AI 분석 실행</a>
            <a href="/" class="btn btn-outline-secondary">메인으로</a>
        </div>
    </div>

    <!-- AIRISS 설정 -->
    <script>
        window.AIRISS_CONFIG = {
            apiUrl: '{{ msa_url|default:"https://web-production-4066.up.railway.app" }}',
            contextData: {{ dept_stats|safe }},
            totalEmployees: {{ total_employees|default:0 }},
            gradeDistribution: {{ grade_distribution|safe }}
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 차트 초기화
        const gradeData = window.AIRISS_CONFIG.gradeDistribution || {"S": 15, "A": 50, "B": 100, "C": 30, "D": 10};
        const deptStats = window.AIRISS_CONFIG.contextData || [];
        
        // 등급 분포 차트
        const ctx = document.getElementById('gradeChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gradeData),
                    datasets: [{
                        data: Object.values(gradeData),
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        title: { display: true, text: '전사 성과 등급 분포' }
                    }
                }
            });
        }
    </script>
</body>
</html>