{% extends 'base.html' %}
{% load static %}

{% block title %}영향력 평가 - {{ employee.name }}{% endblock %}

{% block extra_css %}
<style>
    .evaluation-card {
        background: linear-gradient(135deg, white 0%, #FFF4ED 100%);
        border: 1px solid rgba(255, 107, 0, 0.1);
    }
    
    .impact-option {
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
    }
    
    .impact-option:hover {
        border-color: rgba(255, 107, 0, 0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 107, 0, 0.15);
    }
    
    .impact-option.selected {
        border-color: #FF6B00;
        background: linear-gradient(135deg, white 0%, #FFF4ED 100%);
    }
    
    .values-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }
    
    .value-card {
        position: relative;
        transition: all 0.3s ease;
    }
    
    .value-card:hover {
        transform: scale(1.02);
    }
    
    input[type="radio"]:checked + .value-label {
        background: #FF6B00;
        color: white;
        border-color: #FF6B00;
    }
    
    .value-label {
        display: block;
        padding: 1rem;
        border: 2px solid #E5E7EB;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-white to-brand-gray/10 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <nav class="flex mb-4" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li><a href="{% url 'evaluations:dashboard' %}" class="text-gray-500 hover:text-primary transition-colors">평가관리</a></li>
                    <li><span class="mx-2 text-gray-400">/</span></li>
                    <li><a href="{% url 'evaluations:impact_employees' %}" class="text-gray-500 hover:text-primary transition-colors">영향력 평가</a></li>
                    <li><span class="mx-2 text-gray-400">/</span></li>
                    <li class="text-gray-900 font-medium">{{ employee.name }}</li>
                </ol>
            </nav>
            
            <div class="bg-white rounded-2xl shadow-sm p-6 evaluation-card">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">
                            <i class="fas fa-users text-primary mr-3"></i>영향력 평가
                        </h1>
                        <div class="flex items-center gap-4 text-gray-600">
                            <span class="flex items-center">
                                <i class="fas fa-user mr-2"></i>
                                <strong>{{ employee.name }}</strong> ({{ employee.employee_id }})
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-building mr-2"></i>
                                {{ employee.department.name }}
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-calendar mr-2"></i>
                                {{ active_period }}
                            </span>
                        </div>
                    </div>
                    <div class="text-right">
                        {% if evaluation.total_score %}
                        <div class="text-sm text-gray-500 mb-1">현재 점수</div>
                        <div class="text-3xl font-bold text-primary">{{ evaluation.total_score|floatformat:1 }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- 영향력 범위 평가 -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-6">
                    <i class="fas fa-chart-network text-primary mr-2"></i>영향력 범위
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="impact-option p-6 rounded-lg bg-gray-50 text-center {% if evaluation.impact_scope == 'org' %}selected{% endif %}">
                        <input type="radio" id="scope_org" name="impact_scope" value="org" 
                               {% if evaluation.impact_scope == 'org' %}checked{% endif %}
                               class="sr-only">
                        <label for="scope_org" class="cursor-pointer">
                            <div class="text-4xl mb-3">🏢</div>
                            <div class="font-semibold text-lg mb-2">조직 전체</div>
                            <div class="text-sm text-gray-600">조직 전체에 긍정적 영향</div>
                            <div class="mt-3 text-2xl font-bold text-primary">4점</div>
                        </label>
                    </div>
                    
                    <div class="impact-option p-6 rounded-lg bg-gray-50 text-center {% if evaluation.impact_scope == 'department' %}selected{% endif %}">
                        <input type="radio" id="scope_department" name="impact_scope" value="department" 
                               {% if evaluation.impact_scope == 'department' %}checked{% endif %}
                               class="sr-only">
                        <label for="scope_department" class="cursor-pointer">
                            <div class="text-4xl mb-3">🏗️</div>
                            <div class="font-semibold text-lg mb-2">부서 내</div>
                            <div class="text-sm text-gray-600">소속 부서 내 영향력</div>
                            <div class="mt-3 text-2xl font-bold text-accent">3점</div>
                        </label>
                    </div>
                    
                    <div class="impact-option p-6 rounded-lg bg-gray-50 text-center {% if evaluation.impact_scope == 'team' %}selected{% endif %}">
                        <input type="radio" id="scope_team" name="impact_scope" value="team" 
                               {% if evaluation.impact_scope == 'team' %}checked{% endif %}
                               class="sr-only">
                        <label for="scope_team" class="cursor-pointer">
                            <div class="text-4xl mb-3">👥</div>
                            <div class="font-semibold text-lg mb-2">팀 내</div>
                            <div class="text-sm text-gray-600">팀 내 제한적 영향</div>
                            <div class="mt-3 text-2xl font-bold text-gray-600">2점</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 핵심가치 실천 -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-6">
                    <i class="fas fa-heart text-primary mr-2"></i>핵심가치 실천
                </h2>
                
                <div class="values-grid">
                    <div class="value-card">
                        <input type="radio" id="values_all" name="core_values_practice" value="all_values" 
                               {% if evaluation.core_values_practice == 'all_values' %}checked{% endif %}
                               class="sr-only">
                        <label for="values_all" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🌟</span>
                                <span class="font-semibold">모든 핵심가치 실천</span>
                            </div>
                            <p class="text-sm text-gray-600">혁신, 협력, 신뢰, 도전 등 모든 가치 체화</p>
                            <div class="mt-2 text-lg font-bold text-primary">4점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="values_most" name="core_values_practice" value="most_values" 
                               {% if evaluation.core_values_practice == 'most_values' %}checked{% endif %}
                               class="sr-only">
                        <label for="values_most" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">⭐</span>
                                <span class="font-semibold">대부분 핵심가치 실천</span>
                            </div>
                            <p class="text-sm text-gray-600">3개 이상의 핵심가치 실천</p>
                            <div class="mt-2 text-lg font-bold text-accent">3점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="values_some" name="core_values_practice" value="some_values" 
                               {% if evaluation.core_values_practice == 'some_values' %}checked{% endif %}
                               class="sr-only">
                        <label for="values_some" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">✨</span>
                                <span class="font-semibold">일부 핵심가치 실천</span>
                            </div>
                            <p class="text-sm text-gray-600">1-2개 핵심가치 실천</p>
                            <div class="mt-2 text-lg font-bold text-blue-600">2점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="values_limited" name="core_values_practice" value="limited_values" 
                               {% if evaluation.core_values_practice == 'limited_values' %}checked{% endif %}
                               class="sr-only">
                        <label for="values_limited" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">💫</span>
                                <span class="font-semibold">제한적 실천</span>
                            </div>
                            <p class="text-sm text-gray-600">핵심가치 실천 미흡</p>
                            <div class="mt-2 text-lg font-bold text-gray-600">1점</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 리더십 발휘 -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-6">
                    <i class="fas fa-medal text-primary mr-2"></i>리더십 발휘
                </h2>
                
                <div class="values-grid">
                    <div class="value-card">
                        <input type="radio" id="leader_exceptional" name="leadership_demonstration" value="exceptional_leadership" 
                               {% if evaluation.leadership_demonstration == 'exceptional_leadership' %}checked{% endif %}
                               class="sr-only">
                        <label for="leader_exceptional" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">👑</span>
                                <span class="font-semibold">탁월한 리더십</span>
                            </div>
                            <p class="text-sm text-gray-600">조직 전체에 영향을 미치는 리더십 발휘</p>
                            <div class="mt-2 text-lg font-bold text-primary">4점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="leader_strong" name="leadership_demonstration" value="strong_leadership" 
                               {% if evaluation.leadership_demonstration == 'strong_leadership' %}checked{% endif %}
                               class="sr-only">
                        <label for="leader_strong" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🎯</span>
                                <span class="font-semibold">강한 리더십</span>
                            </div>
                            <p class="text-sm text-gray-600">부서/팀을 이끄는 리더십 발휘</p>
                            <div class="mt-2 text-lg font-bold text-accent">3점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="leader_moderate" name="leadership_demonstration" value="moderate_leadership" 
                               {% if evaluation.leadership_demonstration == 'moderate_leadership' %}checked{% endif %}
                               class="sr-only">
                        <label for="leader_moderate" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🌱</span>
                                <span class="font-semibold">보통 리더십</span>
                            </div>
                            <p class="text-sm text-gray-600">팀 내에서 일부 리더십 발휘</p>
                            <div class="mt-2 text-lg font-bold text-blue-600">2점</div>
                        </label>
                    </div>
                    
                    <div class="value-card">
                        <input type="radio" id="leader_limited" name="leadership_demonstration" value="limited_leadership" 
                               {% if evaluation.leadership_demonstration == 'limited_leadership' %}checked{% endif %}
                               class="sr-only">
                        <label for="leader_limited" class="value-label">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">🌿</span>
                                <span class="font-semibold">제한적 리더십</span>
                            </div>
                            <p class="text-sm text-gray-600">리더십 발휘 기회 제한적</p>
                            <div class="mt-2 text-lg font-bold text-gray-600">1점</div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- 기존 평가 항목 (레거시 호환) -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-6">
                    <i class="fas fa-star text-primary mr-2"></i>세부 평가 항목
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">고객 중심</label>
                        <select name="customer_focus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.customer_focus == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.customer_focus == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.customer_focus == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.customer_focus == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">협업</label>
                        <select name="collaboration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.collaboration == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.collaboration == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.collaboration == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.collaboration == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">혁신</label>
                        <select name="innovation" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.innovation == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.innovation == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.innovation == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.innovation == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">팀 리더십</label>
                        <select name="team_leadership" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.team_leadership == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.team_leadership == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.team_leadership == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.team_leadership == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">조직 영향력</label>
                        <select name="organizational_impact" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.organizational_impact == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.organizational_impact == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.organizational_impact == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.organizational_impact == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">외부 네트워킹</label>
                        <select name="external_networking" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary">
                            <option value="1" {% if evaluation.external_networking == 1 %}selected{% endif %}>1 - 기대 미달</option>
                            <option value="2" {% if evaluation.external_networking == 2 %}selected{% endif %}>2 - 기대 충족</option>
                            <option value="3" {% if evaluation.external_networking == 3 %}selected{% endif %}>3 - 기대 초과</option>
                            <option value="4" {% if evaluation.external_networking == 4 %}selected{% endif %}>4 - 탁월</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 평가 의견 -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">
                    <i class="fas fa-comment-dots text-primary mr-2"></i>평가 의견
                </h2>
                <textarea name="evaluation_comment" 
                          rows="4"
                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                          placeholder="평가 의견을 입력하세요...">{{ evaluation.comment }}</textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-between items-center bg-white rounded-xl shadow-sm p-6">
                <a href="{% url 'evaluations:impact_employees' %}" 
                   class="inline-flex items-center px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>목록으로
                </a>
                <div class="space-x-3">
                    <button type="submit" name="action" value="save" 
                            class="inline-flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">
                        <i class="fas fa-save mr-2"></i>저장
                    </button>
                    <button type="submit" name="action" value="submit" 
                            class="inline-flex items-center px-6 py-3 bg-status-success text-white rounded-lg hover:opacity-90 transition-opacity">
                        <i class="fas fa-check mr-2"></i>평가 완료
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Impact option selection
    const impactOptions = document.querySelectorAll('.impact-option');
    
    impactOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove selected class from all
            impactOptions.forEach(opt => opt.classList.remove('selected'));
            // Add selected class to clicked
            this.classList.add('selected');
            // Check the radio button
            const radio = this.querySelector('input[type="radio"]');
            if (radio) {
                radio.checked = true;
            }
        });
    });
});
</script>
{% endblock %}