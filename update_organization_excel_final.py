#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
조직구조 Excel 파일의 H열(설명)을 OK금융그룹 조직 설명 목록에 따라 업데이트
"""

import pandas as pd
from datetime import datetime
import os

# 조직 코드별 설명 매핑 (전체 85개 조직)
descriptions = {
    # 레벨 1 - 그룹
    'GRP001': 'OK금융그룹의 지주회사로서 그룹 전체의 경영전략 수립, 계열사 관리감독, 그룹 시너지 창출 및 신성장동력 발굴을 담당하는 최상위 조직입니다.',
    
    # 레벨 2 - 계열사
    'COM001': 'OK금융그룹의 핵심 계열사로서 서민금융 지원과 중소기업 금융서비스를 전문으로 하며, 디지털 혁신을 통해 고객 중심의 종합 금융서비스를 제공하는 저축은행입니다.',
    
    # 레벨 3 - 본부
    'HQ001': '기업의 사회적 책임 실현을 위한 전략 수립 및 실행, 홍보/대외협력, 스포츠단 운영 등을 통해 그룹의 브랜드 가치 향상과 사회공헌 활동을 총괄하는 핵심 본부입니다.',
    'HQ002': '그룹의 경영전략, 재무회계, 인사관리, IT 전략 등 경영 전반의 지원기능을 담당하며, 효율적인 자원 배분과 조직 운영을 통해 경영목표 달성을 지원하는 핵심 관리조직입니다.',
    'HQ003': '기업금융, 프로젝트 파이낸싱, 구조화 금융 등 투자은행 업무를 수행하며, 기업고객에 대한 종합적인 금융솔루션 제공을 통해 수익 창출과 성장을 이끄는 전문 금융조직입니다.',
    'HQ004': '개인고객 대상의 예금, 대출, 자산관리 서비스를 제공하며, 디지털 채널과 오프라인 영업점을 통합 운영하여 고객 편의성과 수익성을 극대화하는 소매금융 전문조직입니다.',
    'HQ005': '디지털 전환(DT) 전략 수립 및 실행, 핵심 IT 시스템 구축/운영, 데이터 분석 및 AI/빅데이터 활용을 통해 그룹의 디지털 경쟁력 강화를 주도하는 기술혁신 조직입니다.',
    'HQ006': '신용, 시장, 운영, 유동성 등 각종 리스크의 식별/측정/관리를 통해 안정적인 경영환경을 조성하고, 규제 준수 및 내부통제 강화로 건전성을 확보하는 리스크 전문조직입니다.',
    'HQ007': '독립적인 내부감사 수행을 통해 업무 프로세스의 적정성 검증, 부정/오류 예방, 경영 효율성 제고를 담당하며, 투명하고 건전한 기업문화 정착에 기여하는 감독조직입니다.',
    'HQ008': '윤리강령 제정 및 실천, 준법감시, 내부신고제도 운영 등을 통해 임직원의 윤리의식 제고와 공정하고 투명한 기업문화 구축을 선도하는 윤리경영 전담조직입니다.',
    'HQ009': '고객 문의사항 응대, 불만/민원 처리, VOC 분석을 통한 서비스 개선 등 고객만족도 향상을 위한 통합 고객서비스를 제공하는 고객접점 운영조직입니다.',
    'HQ010': '금융관련 법규 준수 여부 모니터링, 내부통제 시스템 구축/운영, 자금세탁방지(AML) 등을 통해 법적 리스크를 최소화하고 건전한 금융질서 확립에 기여하는 컴플라이언스 조직입니다.',
    
    # 레벨 4 - 부서
    'DEPT001': 'OK저축은행 스포츠단의 운영 지원, 선수단 관리, 대회 참가 기획, 팬 마케팅 등을 통해 스포츠를 통한 기업 이미지 제고와 사회공헌을 실현하는 스포츠 마케팅 조직입니다.',
    'DEPT002': '중장기 경영전략 수립, 연간 사업계획 수립 및 실적 관리, 신규 사업 기회 발굴, 조직 구조 개편 등 전사적 경영관리 업무를 수행하는 전략기획 부서입니다.',
    'DEPT003': '자금 조달 및 운용, 총무/구매, 인사/교육 등 경영활동에 필요한 제반 지원업무를 통해 원활한 조직 운영과 업무 효율성 향상을 도모하는 경영지원 부서입니다.',
    'DEPT004': 'IT 중장기 로드맵 수립, 디지털 전환 프로젝트 기획, IT 예산 관리, 시스템 아키텍처 설계 등을 통해 기술 혁신과 업무 효율화를 추진하는 IT 전략 부서입니다.',
    'DEPT005': '대기업 및 중견기업 고객 대상 기업금융, 신디케이트론, 프로젝트 파이낸싱 등 대형 딜을 전담하며, 복합금융 솔루션 제공을 통해 수익을 창출하는 IB 1부서입니다.',
    'DEPT006': '중소/중견기업 및 벤처기업 대상 성장금융, 기술금융, M&A 자문 등을 전담하며, 혁신기업 발굴과 육성을 통해 미래 성장동력을 확보하는 IB 2부서입니다.',
    'DEPT007': '기업 및 개인 여신에 대한 종합적인 신용평가, 심사기준 수립, 여신 포트폴리오 관리 등을 통해 건전한 자산 운용과 리스크 관리를 수행하는 심사 전문부서입니다.',
    'DEPT008': '개인고객 영업전략 수립, 영업점 관리, 상품개발 협업, 영업 캠페인 기획 등을 통해 리테일 부문의 수익 극대화와 고객기반 확대를 추진하는 소매금융 관리부서입니다.',
    'DEPT009': '디지털 금융 플랫폼 구축, 핀테크 제휴, 빅데이터 분석, AI 서비스 개발 등을 통해 디지털 기반의 혁신적인 금융서비스를 창출하는 디지털 전환 주도부서입니다.',
    'DEPT010': '핵심 뱅킹 시스템 개발/유지보수, 신규 서비스 시스템 구축, API 개발, 시스템 통합 등을 수행하여 안정적이고 효율적인 IT 인프라를 제공하는 시스템 개발부서입니다.',
    'DEPT011': '전산 시스템 운영, 네트워크/서버 관리, 정보보안, 재해복구 체계 운영 등을 통해 24/7 무중단 금융 서비스 제공을 보장하는 IT 인프라 운영부서입니다.',
    'DEPT012': '신용리스크 측정 모델 개발, 신용등급 산정, 예상손실 산출, 스트레스 테스트 등을 통해 신용리스크를 정량화하고 관리방안을 수립하는 리스크 분석부서입니다.',
    'DEPT013': '업무 프로세스 리스크 평가, 운영손실 데이터 관리, 업무연속성계획(BCP) 수립 등을 통해 운영상 발생 가능한 리스크를 예방하고 관리하는 운영리스크 전문부서입니다.',
    'DEPT014': '영업부문에 대한 정기/수시 감사, 금융사고 조사, 영업점 컴플라이언스 점검 등을 통해 영업 현장의 건전성과 규정 준수를 확보하는 영업감사 부서입니다.',
    'DEPT015': '본부부서 및 IT 시스템에 대한 감사, 경영진 특명감사, 프로세스 개선 제안 등을 통해 경영 효율성 제고와 내부통제 강화를 담당하는 경영감사 부서입니다.',
    'DEPT016': '자금세탁 방지 시스템 운영, 의심거래 보고(STR), 고객확인의무(CDD) 이행, 금융정보분석원 대응 등을 통해 금융범죄를 예방하는 AML 전문부서입니다.',
    'DEPT017': '금융소비자보호 정책 수립, 민원 처리 프로세스 관리, 불완전판매 예방, 금융교육 프로그램 운영 등을 통해 고객 권익을 보호하는 소비자보호 전담부서입니다.',
    'DEPT018': '기업 및 개인 대출 영업전략 수립, 대출 상품 개발, 영업 채널 관리, 대출 실적 분석 등을 통해 대출 자산의 양적/질적 성장을 추진하는 여신영업 부서입니다.',
    'DEPT019': '부실채권 관리, 담보물 처분, 채권 회수 전략 수립, 특수채권 관리 등을 통해 부실자산의 조기 정상화와 손실 최소화를 도모하는 자산건전성 관리부서입니다.',
    'DEPT020': '중소/중견기업 금융 지원, 정책자금 연계 대출, 기업 컨설팅 서비스 등을 통해 기업고객과의 동반성장을 추구하는 기업금융 전문부서입니다.',
    'DEPT021': '외화자금 조달/운용, 해외 금융기관 제휴, 무역금융, 외환 딜링 등을 수행하여 국제금융 역량을 강화하고 글로벌 비즈니스를 확대하는 국제업무 부서입니다.',
    'DEPT022': '브랜드 전략 수립, 마케팅 캠페인 기획/실행, 고객 세분화, CRM 전략 등을 통해 브랜드 가치 제고와 고객 유치/유지를 담당하는 마케팅 전략부서입니다.',
    
    # 레벨 5 - 팀
    'TEAM001': '대내외 홍보활동, 언론 대응, 사회공헌 프로그램 기획 및 운영, 브랜드 관리 등을 통해 기업 이미지 제고와 사회적 가치 창출을 담당하는 홍보/CSR 실행조직입니다.',
    'TEAM002': '경영전략 실행계획 수립, KPI 관리, 경영회의 운영, 대외 제출자료 작성 등 CEO 및 경영진의 의사결정을 지원하고 전략과제를 추진하는 기획 실무조직입니다.',
    'TEAM003': '재무제표 작성, 세무신고, 예산편성 및 집행관리, 원가분석, 관리회계 등을 통해 재무 건전성 확보와 경영 의사결정에 필요한 재무정보를 제공하는 회계 전문조직입니다.',
    'TEAM004': '여유자금 운용, 유동성 관리, 자금조달 계획 수립 및 실행, 금리리스크 헤지 등을 통해 안정적인 자금 흐름을 유지하고 수익을 창출하는 자금관리 조직입니다.',
    'TEAM005': '사옥 및 영업점 관리, 구매/계약, 차량관리, 복리후생 운영, 각종 행사 지원 등 임직원의 근무환경 개선과 업무 지원을 담당하는 총무 서비스 조직입니다.',
    'TEAM006': '채용, 인사평가, 승진/보상, 교육훈련, 조직문화 개선, 노무관리 등을 통해 우수 인재 확보와 육성, 직원 만족도 향상을 추진하는 인적자원 관리조직입니다.',
    'TEAM007': 'IT 프로젝트 관리, 시스템 요구사항 분석, 업무 프로세스 개선, IT 투자 효과 분석 등을 수행하여 비즈니스와 IT의 정렬을 도모하는 IT 기획 실무조직입니다.',
    'TEAM008': '대기업 및 공공기관 대상 대규모 프로젝트 파이낸싱, 신디케이트론 주선, 회사채 발행 주선 등을 전담하는 대기업 전문 IB 실행팀입니다.',
    'TEAM009': '부동산 PF, REITs, 부동산 펀드 등 부동산 관련 구조화 금융을 전문으로 하며, 개발사업 금융자문을 제공하는 부동산금융 전문팀입니다.',
    'TEAM010': '중견/중소기업 M&A 자문, 성장금융, 벤처 투자 등을 담당하며, 혁신기업의 성장을 금융으로 지원하는 중소기업 IB 전문팀입니다.',
    'TEAM011': '해외 프로젝트 파이낸싱, 무역금융, 외화 신디케이트론 등 국제금융 업무를 전담하는 글로벌 IB 실행팀입니다.',
    'TEAM012': '대기업 및 중견기업 여신 심사, 신용등급 평가, 한도 설정 등을 담당하며, 기업 규모별 맞춤형 심사를 수행하는 기업여신 심사팀입니다.',
    'TEAM013': '중소기업 및 개인사업자 여신 심사, 신용평가 모델 운영, 소호(SOHO) 대출 심사 등을 전담하는 중소기업 여신심사팀입니다.',
    'TEAM014': '개인 신용대출, 주택담보대출 심사, 개인신용평가 시스템 운영 등을 담당하는 개인여신 전문 심사팀입니다.',
    'TEAM015': '수도권 지역 영업점 관리, 신규 고객 유치 전략 수립, 지역별 맞춤 상품 판매 등을 담당하는 수도권 리테일 영업팀입니다.',
    'TEAM016': '지방 지역 영업점 관리, 지역 특화 금융서비스 제공, 지역사회 연계 마케팅 등을 수행하는 지방 리테일 영업팀입니다.',
    'TEAM017': 'VIP 고객 관리, 자산관리 서비스, PB 영업 등 고액 자산가를 위한 프리미엄 금융서비스를 제공하는 자산관리 전문팀입니다.',
    'TEAM018': '신용 VaR 산출, 신용등급 이행률 분석, 부도율 예측 모델 개발 등을 통해 신용리스크를 계량화하고 관리하는 신용리스크 분석팀입니다.',
    'TEAM019': '금리, 환율, 주가 등 시장리스크 측정, 트레이딩 포지션 모니터링, 파생상품 리스크 관리 등을 담당하는 시장리스크 전문팀입니다.',
    'TEAM020': '운영리스크 시나리오 분석, 핵심위험지표(KRI) 관리, 업무 프로세스 리스크 평가 등을 수행하는 운영리스크 관리팀입니다.',
    'TEAM021': '연간 감사계획 수립, 감사 방법론 개발, 감사 결과 분석 및 보고 등 감사업무 전반을 기획하고 조정하는 감사 기획팀입니다.',
    'TEAM022': '영업점 정기감사, 영업 규정 준수 점검, 불건전 영업행위 조사 등을 통해 영업 현장의 건전성을 확보하는 영업 감사팀입니다.',
    'TEAM023': '본부 부서 감사, 경영 프로세스 진단, IT 시스템 감사 등을 수행하여 경영 효율성과 내부통제를 강화하는 경영 감사팀입니다.',
    'TEAM024': '법규 변경사항 모니터링, 내규 제/개정, 준법 교육, 법률 자문 등을 통해 전사적 준법경영을 지원하는 컴플라이언스 실무팀입니다.',
    'TEAM025': '계정계 시스템, 여수신 시스템 등 핵심 뱅킹 시스템의 개발과 유지보수를 담당하며, 안정적인 금융 거래 처리를 보장하는 코어뱅킹 개발팀입니다.',
    'TEAM026': '정보계 시스템, 리스크관리 시스템, 경영정보 시스템 등의 개발을 담당하며, 데이터 기반 의사결정을 지원하는 정보시스템 개발팀입니다.',
    'TEAM027': '서버, 네트워크, 데이터베이스 등 IT 인프라의 운영과 관리를 담당하며, 24시간 무중단 서비스를 보장하는 인프라 운영팀입니다.',
    'TEAM028': '정보보안, 재해복구, 시스템 모니터링 등을 담당하며, 사이버 위협으로부터 시스템을 보호하고 업무 연속성을 확보하는 보안운영팀입니다.',
    'TEAM029': '모바일뱅킹, 인터넷뱅킹 앱/웹 개발, UI/UX 개선, 신기술 적용 등을 통해 고객의 디지털 뱅킹 경험을 혁신하는 디지털채널 개발조직입니다.',
    'TEAM030': '디지털 채널 운영, 장애 대응, 고객 피드백 분석, 서비스 개선 등을 통해 안정적이고 편리한 디지털 금융 서비스를 제공하는 채널 운영조직입니다.',
    'TEAM031': '기업대출 영업, 신규 기업고객 발굴, 기업 금융 컨설팅 등을 통해 기업 여신 확대를 추진하는 기업대출 영업팀입니다.',
    'TEAM032': '개인대출 상품 판매, 주택담보대출 상담, 전세자금대출 등 개인고객 대출 영업을 전담하는 개인대출 영업팀입니다.',
    'TEAM033': 'CTR/STR 보고, 고객확인절차(KYC) 운영, AML 시스템 관리 등을 통해 자금세탁 및 테러자금조달을 방지하는 AML 실무팀입니다.'
}

def update_organization_excel():
    """조직구조 Excel 파일의 H열 업데이트"""
    
    # 파일 경로
    input_file = r'D:\EHR_project\조직구조_업로드_hierarchy_backup_20250822_093553.xlsx'
    output_file = r'D:\EHR_project\조직구조_업로드_최종.xlsx'
    
    print("="*60)
    print("조직구조 Excel 파일 H열(설명) 업데이트")
    print("="*60)
    
    # Excel 파일 읽기
    try:
        df = pd.read_excel(input_file, engine='openpyxl')
        print(f"\n[OK] Excel 파일 로드 완료: {len(df)}개 행")
        
        # 컬럼 확인
        print(f"\n현재 컬럼: {df.columns.tolist()}")
        
        # 필요한 컬럼 확인
        required_columns = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']
        if not all(col in df.columns for col in required_columns):
            print("\n[WARNING] 컬럼명이 A, B, C... 형식이 아님. 인덱스로 접근합니다.")
            # 컬럼명을 A, B, C... 형식으로 변경
            df.columns = [chr(65+i) for i in range(len(df.columns))]
            print(f"변경된 컬럼: {df.columns.tolist()}")
        
    except Exception as e:
        print(f"[ERROR] 파일 읽기 실패: {e}")
        return
    
    # H열 업데이트
    updated_count = 0
    not_found = []
    
    print("\n조직 코드별 설명 매핑 시작...")
    
    for idx, row in df.iterrows():
        org_code = str(row['A']).strip() if pd.notna(row['A']) else ''
        
        if org_code in descriptions:
            df.at[idx, 'H'] = descriptions[org_code]
            updated_count += 1
            print(f"  [OK] {org_code}: {row['B']} - 설명 추가")
        else:
            if org_code and org_code != 'nan':
                not_found.append(f"{org_code} ({row['B']})")
    
    # 결과 출력
    print(f"\n업데이트 완료:")
    print(f"  - 전체 조직: {len(df)}개")
    print(f"  - 설명 추가: {updated_count}개")
    print(f"  - 설명 없음: {len(not_found)}개")
    
    if not_found:
        print(f"\n[WARNING] 설명이 없는 조직 코드:")
        for item in not_found[:10]:  # 처음 10개만 표시
            print(f"    - {item}")
        if len(not_found) > 10:
            print(f"    ... 외 {len(not_found)-10}개")
    
    # 파일 저장
    try:
        df.to_excel(output_file, index=False, engine='openpyxl')
        print(f"\n[OK] 파일 저장 완료: {output_file}")
        
        # 파일 크기 확인
        file_size = os.path.getsize(output_file)
        print(f"    파일 크기: {file_size:,} bytes")
        
    except Exception as e:
        print(f"\n[ERROR] 파일 저장 실패: {e}")
        return
    
    # 레벨별 통계
    print("\n레벨별 조직 수:")
    level_counts = df['D'].value_counts().sort_index()
    level_names = {1: '그룹', 2: '계열사', 3: '본부', 4: '부서', 5: '팀'}
    for level, count in level_counts.items():
        if pd.notna(level) and int(level) in level_names:
            print(f"  레벨 {int(level)} ({level_names[int(level)]}): {count}개")
    
    # H열 채워진 비율
    h_filled = df['H'].notna().sum()
    h_empty = df['H'].isna().sum()
    fill_rate = (h_filled / len(df)) * 100 if len(df) > 0 else 0
    
    print(f"\nH열(설명) 상태:")
    print(f"  - 채워짐: {h_filled}개")
    print(f"  - 비어있음: {h_empty}개")
    print(f"  - 완성률: {fill_rate:.1f}%")
    
    print("\n="*60)
    print("작업 완료!")
    print("="*60)

if __name__ == "__main__":
    update_organization_excel()