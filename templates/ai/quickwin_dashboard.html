{% extends 'ai_base.html' %}
{% load static %}

{% block title %}AI Quick Win Dashboard - OK금융그룹{% endblock %}

{% block breadcrumb %}
<div class="px-6 lg:px-8 py-3 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
    <nav aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm">
            <li>
                <a href="{% url 'home' %}" class="text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors">
                    <i data-lucide="home" class="w-4 h-4"></i>
                </a>
            </li>
            <li class="flex items-center">
                <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 mx-2"></i>
                <span class="text-gray-900 dark:text-gray-100 font-medium">AI Quick Win 통합 대시보드</span>
            </li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .ai-module-card {
        background: white;
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .ai-module-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 40px rgba(255, 107, 0, 0.15);
    }
    
    .ai-module-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #FF6B00, #FFAA00);
    }
    
    .module-icon {
        width: 60px;
        height: 60px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #FFF4ED 0%, #FFEDE5 100%);
        border-radius: 16px;
        padding: 20px;
        text-align: center;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #FF6B00;
        margin-bottom: 8px;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.875rem;
    }
    
    .module-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
    }
    
    .module-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .status-active {
        background: #d4edda;
        color: #155724;
    }
    
    .status-beta {
        background: #fff3cd;
        color: #856404;
    }
    
    .status-coming {
        background: #f8d7da;
        color: #721c24;
    }
    
    .progress-bar {
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 12px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #FF6B00, #FFAA00);
        border-radius: 4px;
        transition: width 0.6s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">AI Quick Win Dashboard</h1>
                <p class="text-sm text-gray-600 mt-1">OK금융그룹 AI 혁신 솔루션</p>
            </div>
            <div class="flex items-center gap-3">
                <button class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                    <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                    새로고침
                </button>
                <button class="px-4 py-2 gradient-bg text-white rounded-lg hover:shadow-lg transition-all">
                    <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>
                    설정
                </button>
            </div>
        </div>
    </div>
    
    <div class="p-6">
        <!-- 통계 카드 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">7</div>
                <div class="stat-label">활성 AI 모듈</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">1,234</div>
                <div class="stat-label">일일 AI 분석</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">89%</div>
                <div class="stat-label">정확도</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2.5초</div>
                <div class="stat-label">평균 응답시간</div>
            </div>
        </div>
        
        <!-- AI 모듈 그리드 -->
        <div class="module-grid">
            <!-- AI 팀 최적화 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i data-lucide="users" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">팀 조합 최적화</h3>
                <span class="module-status status-active">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    Active
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    AI 기반 최적의 팀 구성을 추천하고 성과를 예측합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">85%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85%;"></div>
                </div>
                <a href="{% url 'ai_team_optimizer:dashboard' %}" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- 실시간 코칭 어시스턴트 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i data-lucide="message-circle" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">실시간 코칭 어시스턴트</h3>
                <span class="module-status status-active">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    Active
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    개인별 맞춤 코칭과 실시간 피드백을 제공합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">70%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 70%;"></div>
                </div>
                <a href="{% url 'ai_coaching:dashboard' %}" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- AI 인사이트 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <i data-lucide="trending-up" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">AI 인사이트 대시보드</h3>
                <span class="module-status status-beta">
                    <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                    Beta
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    조직 전반의 인사이트와 트렌드를 분석합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">60%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 60%;"></div>
                </div>
                <a href="{% url 'ai_insights:executive_dashboard' %}" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- 이직 예측 분석 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <i data-lucide="user-check" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">이직 예측 분석</h3>
                <span class="module-status status-beta">
                    <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                    Beta
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    이직 리스크를 예측하고 예방 전략을 제시합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">55%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 55%;"></div>
                </div>
                <a href="{% url 'ai_predictions:turnover_dashboard' %}" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- AI 면접 도우미 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                    <i data-lucide="video" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">AI 면접 도우미</h3>
                <span class="module-status status-beta">
                    <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                    Beta
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    AI 기반 면접 질문 생성과 평가를 지원합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">50%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 50%;"></div>
                </div>
                <a href="{% url 'ai_interviewer:interview_dashboard' %}" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- AI 채용 추천 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);">
                    <i data-lucide="user-plus" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">AI 채용 추천</h3>
                <span class="module-status status-coming">
                    <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                    Coming Soon
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    최적의 인재를 자동으로 매칭하고 추천합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">30%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 30%;"></div>
                </div>
                <button disabled class="mt-4 inline-flex items-center text-gray-400 cursor-not-allowed">
                    <span class="text-sm font-medium">준비중</span>
                    <i data-lucide="lock" class="w-4 h-4 ml-1"></i>
                </button>
            </div>
            
            <!-- AI 리더 어시스턴트 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);">
                    <i data-lucide="crown" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">리더 AI 어시스턴트</h3>
                <span class="module-status status-active">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    Active
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    리더를 위한 의사결정 지원과 전략 제안을 제공합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">75%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%;"></div>
                </div>
                <a href="/ai/leader-assistant/" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">대시보드 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
            
            <!-- AI 챗봇 -->
            <div class="ai-module-card">
                <div class="module-icon" style="background: linear-gradient(135deg, #13547a 0%, #80d0c7 100%);">
                    <i data-lucide="bot" class="w-8 h-8 text-white"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">AI 챗봇</h3>
                <span class="module-status status-active">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    Active
                </span>
                <p class="text-gray-600 text-sm mt-3 mb-4">
                    HR 관련 질문에 24/7 즉시 답변을 제공합니다.
                </p>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-500">완성도</span>
                    <span class="text-xs font-semibold">80%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 80%;"></div>
                </div>
                <a href="/ai/chatbot/" class="mt-4 inline-flex items-center text-primary hover:text-primary-hover transition-colors">
                    <span class="text-sm font-medium">챗봇 열기</span>
                    <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                </a>
            </div>
        </div>
    </div>
    
    <!-- AIRISS 통합 상태 섹션 -->
    <div class="mt-8 bg-white rounded-2xl shadow-lg p-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-900">AIRISS 서비스 통합 상태</h2>
            <button onclick="checkIntegrationStatus()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors">
                <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>
                상태 확인
            </button>
        </div>
        
        <div id="integration-status" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- 통합 상태가 여기에 동적으로 로드됩니다 -->
            <div class="text-center text-gray-500 col-span-full py-8">
                <i data-lucide="loader" class="w-8 h-8 mx-auto mb-2 animate-spin"></i>
                <p>통합 상태를 불러오는 중...</p>
            </div>
        </div>
        
        <!-- 직원 동기화 섹션 -->
        <div class="mt-6 pt-6 border-t border-gray-200">
            <h3 class="text-lg font-semibold mb-4">직원 데이터 동기화</h3>
            <div class="flex items-center gap-4">
                <input type="number" id="employee-id" placeholder="직원 ID 입력" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                <button onclick="syncEmployee()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <i data-lucide="user-check" class="w-4 h-4 inline mr-2"></i>
                    개별 동기화
                </button>
                <button onclick="generateReport()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i>
                    종합 리포트
                </button>
            </div>
            <div id="sync-result" class="mt-4"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Lucide icons
    lucide.createIcons();
    
    // Load integration status on page load
    checkIntegrationStatus();
    
    // Animate progress bars on page load
    setTimeout(() => {
        document.querySelectorAll('.progress-fill').forEach(bar => {
            const width = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = width;
            }, 100);
        });
    }, 100);
    
    // Refresh button
    document.querySelector('button').addEventListener('click', function() {
        if (this.textContent.includes('새로고침')) {
            location.reload();
        }
    });
});

// AIRISS 통합 상태 확인
function checkIntegrationStatus() {
    fetch('/ai/api/integration-status/')
        .then(response => response.json())
        .then(data => {
            displayIntegrationStatus(data);
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('integration-status').innerHTML = `
                <div class="col-span-full text-center text-red-500">
                    <p>통합 상태를 불러오는데 실패했습니다.</p>
                </div>
            `;
        });
}

// 통합 상태 표시
function displayIntegrationStatus(data) {
    const statusContainer = document.getElementById('integration-status');
    let html = '';
    
    // 전체 상태 표시
    const healthColor = data.integration_health === 'HEALTHY' ? 'green' : 
                       data.integration_health === 'DEGRADED' ? 'yellow' : 'red';
    
    html += `
        <div class="col-span-full mb-4 p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center justify-between">
                <span class="font-semibold">전체 통합 상태</span>
                <span class="px-3 py-1 bg-${healthColor}-100 text-${healthColor}-800 rounded-full text-sm font-medium">
                    ${data.integration_health}
                </span>
            </div>
        </div>
    `;
    
    // 각 모듈 상태 표시
    if (data.modules) {
        Object.entries(data.modules).forEach(([module, info]) => {
            const isActive = info.active || info.connected;
            const statusColor = isActive ? 'green' : 'gray';
            const statusText = isActive ? 'Active' : 'Inactive';
            
            html += `
                <div class="p-4 border border-gray-200 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-medium text-gray-900">${formatModuleName(module)}</h4>
                        <span class="w-2 h-2 bg-${statusColor}-500 rounded-full"></span>
                    </div>
                    <p class="text-sm text-gray-600">상태: ${statusText}</p>
                    ${info.recent_insights !== undefined ? `<p class="text-sm text-gray-600">최근 활동: ${info.recent_insights}</p>` : ''}
                    ${info.active_sessions !== undefined ? `<p class="text-sm text-gray-600">활성 세션: ${info.active_sessions}</p>` : ''}
                    ${info.active_projects !== undefined ? `<p class="text-sm text-gray-600">활성 프로젝트: ${info.active_projects}</p>` : ''}
                </div>
            `;
        });
    }
    
    statusContainer.innerHTML = html;
    lucide.createIcons();
}

// 모듈 이름 포맷팅
function formatModuleName(module) {
    const names = {
        'airiss': 'AIRISS Core',
        'ai_insights': 'AI 인사이트',
        'ai_predictions': '이직 예측',
        'ai_interviewer': 'AI 면접관',
        'ai_team_optimizer': '팀 최적화',
        'ai_coaching': '코칭 어시스턴트'
    };
    return names[module] || module;
}

// 직원 동기화
function syncEmployee() {
    const employeeId = document.getElementById('employee-id').value;
    
    if (!employeeId) {
        alert('직원 ID를 입력해주세요.');
        return;
    }
    
    const resultDiv = document.getElementById('sync-result');
    resultDiv.innerHTML = '<p class="text-gray-500">동기화 중...</p>';
    
    fetch(`/ai/api/sync/employee/${employeeId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-800 font-medium">동기화 성공!</p>
                    <p class="text-sm text-green-600 mt-1">직원: ${data.employee_name}</p>
                    <p class="text-sm text-green-600">이직 위험도: ${data.analysis_summary.risk_level} (${data.analysis_summary.turnover_risk_score}%)</p>
                    <p class="text-sm text-green-600">승진 준비도: ${data.analysis_summary.promotion_readiness} (${data.analysis_summary.promotion_potential_score}%)</p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                    <p class="text-red-800">동기화 실패: ${data.error}</p>
                </div>
            `;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultDiv.innerHTML = `
            <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-red-800">오류가 발생했습니다.</p>
            </div>
        `;
    });
}

// 종합 리포트 생성
function generateReport() {
    const employeeId = document.getElementById('employee-id').value;
    
    if (!employeeId) {
        alert('직원 ID를 입력해주세요.');
        return;
    }
    
    const resultDiv = document.getElementById('sync-result');
    resultDiv.innerHTML = '<p class="text-gray-500">리포트 생성 중...</p>';
    
    fetch(`/ai/api/report/${employeeId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayReport(data.report);
            } else {
                resultDiv.innerHTML = `
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-red-800">리포트 생성 실패: ${data.error}</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            resultDiv.innerHTML = `
                <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                    <p class="text-red-800">오류가 발생했습니다.</p>
                </div>
            `;
        });
}

// 리포트 표시
function displayReport(report) {
    const resultDiv = document.getElementById('sync-result');
    
    let html = `
        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h4 class="font-bold text-blue-900 mb-3">종합 AI 분석 리포트</h4>
            <div class="space-y-2">
                <p class="text-sm"><strong>직원:</strong> ${report.employee.name} (${report.employee.position})</p>
                <p class="text-sm"><strong>부서:</strong> ${report.employee.department}</p>
    `;
    
    if (report.modules.airiss) {
        const airiss = report.modules.airiss;
        html += `
            <div class="mt-3 pt-3 border-t border-blue-200">
                <p class="font-semibold text-blue-800">AIRISS 분석</p>
                <p class="text-sm">이직 위험도: ${airiss.turnover_risk.score}%</p>
                <p class="text-sm">승진 가능성: ${airiss.promotion_potential.score}%</p>
            </div>
        `;
    }
    
    if (report.modules.coaching) {
        const coaching = report.modules.coaching;
        html += `
            <div class="mt-3 pt-3 border-t border-blue-200">
                <p class="font-semibold text-blue-800">코칭 현황</p>
                <p class="text-sm">활성 세션: ${coaching.active_sessions}</p>
                <p class="text-sm">완료 목표: ${coaching.completed_goals} / ${coaching.total_goals}</p>
            </div>
        `;
    }
    
    if (report.summary) {
        html += `
            <div class="mt-3 pt-3 border-t border-blue-200">
                <p class="font-semibold text-blue-800">종합 평가</p>
                <p class="text-sm">상태: ${report.summary.overall_status}</p>
                ${report.summary.immediate_actions.length > 0 ? 
                    `<p class="text-sm mt-1"><strong>즉시 조치사항:</strong></p>
                    <ul class="list-disc list-inside text-sm ml-2">
                        ${report.summary.immediate_actions.map(action => `<li>${action}</li>`).join('')}
                    </ul>` : ''}
            </div>
        `;
    }
    
    html += `
            </div>
        </div>
    `;
    
    resultDiv.innerHTML = html;
}

// CSRF 토큰 가져오기
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}