{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}대시보드 - OK금융그룹 e-HR{% endblock %}

{% block extra_css %}
<style>
    .stat-card {
        @apply bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow duration-200;
    }
    
    .chart-container {
        @apply bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6;
    }
    
    .activity-item {
        @apply flex items-start space-x-3 py-3 border-b border-gray-100 dark:border-gray-700 last:border-0;
    }
    
    .progress-bar {
        @apply bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden;
    }
    
    .progress-fill {
        @apply bg-primary h-full rounded-full transition-all duration-500;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">안녕하세요, {{ user.get_full_name|default:user.username }}님!</h1>
        <p class="text-gray-600 dark:text-gray-400 mt-2">오늘도 좋은 하루 되세요. 현재 시각: <span id="current-time"></span></p>
    </div>
    
    <!-- Quick Actions -->
    <div class="mb-8">
        <div class="flex flex-wrap gap-4">
            <button class="btn btn-primary" onclick="window.location.href='{% url 'evaluations:dashboard' %}'">
                <i class="fas fa-plus-circle mr-2"></i> 평가 시작
            </button>
            <button class="btn btn-secondary" onclick="window.location.href='{% url 'employees:list' %}'">
                <i class="fas fa-users mr-2"></i> 직원 조회
            </button>
            <button class="btn btn-secondary" onclick="window.location.href='{% url 'job_profiles:list' %}'">
                <i class="fas fa-sitemap mr-2"></i> 직무 체계도
            </button>
            <button class="btn btn-ghost" onclick="showToast('기능 준비 중입니다', 'info')">
                <i class="fas fa-file-export mr-2"></i> 보고서 생성
            </button>
        </div>
    </div>
    
    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Employees -->
        <div class="stat-card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">전체 직원</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white mt-2">{{ total_employees|default:"1,234" }}</p>
                    <p class="text-sm text-green-600 mt-2">
                        <i class="fas fa-arrow-up"></i> +2.5% 전월 대비
                    </p>
                </div>
                <div class="p-3 bg-blue-100 dark:bg-blue-900 rounded-full">
                    <i class="fas fa-users text-2xl text-blue-600 dark:text-blue-300"></i>
                </div>
            </div>
        </div>
        
        <!-- Active Evaluations -->
        <div class="stat-card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">진행중인 평가</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white mt-2">{{ active_evaluations|default:"45" }}</p>
                    <p class="text-sm text-amber-600 mt-2">
                        <i class="fas fa-clock"></i> 7일 남음
                    </p>
                </div>
                <div class="p-3 bg-amber-100 dark:bg-amber-900 rounded-full">
                    <i class="fas fa-chart-line text-2xl text-amber-600 dark:text-amber-300"></i>
                </div>
            </div>
        </div>
        
        <!-- Pending Approvals -->
        <div class="stat-card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">승인 대기</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white mt-2">{{ pending_approvals|default:"12" }}</p>
                    <p class="text-sm text-red-600 mt-2">
                        <i class="fas fa-exclamation-circle"></i> 즉시 확인 필요
                    </p>
                </div>
                <div class="p-3 bg-red-100 dark:bg-red-900 rounded-full">
                    <i class="fas fa-inbox text-2xl text-red-600 dark:text-red-300"></i>
                </div>
            </div>
        </div>
        
        <!-- Training Progress -->
        <div class="stat-card">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-400">교육 이수율</p>
                    <p class="text-2xl font-bold text-gray-900 dark:text-white mt-2">{{ training_completion|default:"78%" }}</p>
                    <p class="text-sm text-green-600 mt-2">
                        <i class="fas fa-check-circle"></i> 목표 초과 달성
                    </p>
                </div>
                <div class="p-3 bg-green-100 dark:bg-green-900 rounded-full">
                    <i class="fas fa-graduation-cap text-2xl text-green-600 dark:text-green-300"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Department Performance Chart -->
        <div class="lg:col-span-2">
            <div class="chart-container">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">부서별 성과 현황</h3>
                    <select class="text-sm px-3 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700">
                        <option>이번 분기</option>
                        <option>지난 분기</option>
                        <option>연간</option>
                    </select>
                </div>
                <div class="h-64">
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Recent Activities -->
        <div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">최근 활동</h3>
                <div class="space-y-1">
                    <div class="activity-item">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-full">
                            <i class="fas fa-user-plus text-blue-600 dark:text-blue-300"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">신규 직원 입사</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">김철수 - IT개발팀</p>
                            <p class="text-xs text-gray-400 mt-1">2시간 전</p>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="p-2 bg-green-100 dark:bg-green-900 rounded-full">
                            <i class="fas fa-check-circle text-green-600 dark:text-green-300"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">평가 완료</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">2023년 상반기 평가</p>
                            <p class="text-xs text-gray-400 mt-1">5시간 전</p>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="p-2 bg-amber-100 dark:bg-amber-900 rounded-full">
                            <i class="fas fa-award text-amber-600 dark:text-amber-300"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">승진 발표</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">박영희 과장 → 차장</p>
                            <p class="text-xs text-gray-400 mt-1">1일 전</p>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-full">
                            <i class="fas fa-certificate text-purple-600 dark:text-purple-300"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">자격증 취득</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">정보처리기사 - 이민수</p>
                            <p class="text-xs text-gray-400 mt-1">2일 전</p>
                        </div>
                    </div>
                </div>
                
                <button class="w-full mt-4 text-sm text-primary hover:text-primary-hover font-medium">
                    전체 활동 보기 <i class="fas fa-arrow-right ml-1"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Secondary Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
        <!-- Team Progress -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">팀별 목표 달성률</h3>
            <div class="space-y-4">
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">IT개발팀</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">92%</span>
                    </div>
                    <div class="progress-bar h-2">
                        <div class="progress-fill" style="width: 92%"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">영업팀</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">87%</span>
                    </div>
                    <div class="progress-bar h-2">
                        <div class="progress-fill" style="width: 87%"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">마케팅팀</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">78%</span>
                    </div>
                    <div class="progress-bar h-2">
                        <div class="progress-fill" style="width: 78%"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">인사팀</span>
                        <span class="text-sm font-medium text-gray-900 dark:text-white">95%</span>
                    </div>
                    <div class="progress-bar h-2">
                        <div class="progress-fill" style="width: 95%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Upcoming Events -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">예정된 일정</h3>
            <div class="space-y-3">
                <div class="flex items-start space-x-3">
                    <div class="text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">12월</div>
                        <div class="text-2xl font-bold text-primary">15</div>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">연말 평가 마감</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">2023년 하반기 성과평가</p>
                        <div class="flex items-center mt-1 text-xs text-gray-500">
                            <i class="fas fa-clock mr-1"></i> 오후 6:00
                        </div>
                    </div>
                </div>
                
                <div class="flex items-start space-x-3">
                    <div class="text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">12월</div>
                        <div class="text-2xl font-bold text-primary">20</div>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">리더십 워크샵</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">팀장 이상 필수 참석</p>
                        <div class="flex items-center mt-1 text-xs text-gray-500">
                            <i class="fas fa-map-marker-alt mr-1"></i> 본사 대회의실
                        </div>
                    </div>
                </div>
                
                <div class="flex items-start space-x-3">
                    <div class="text-center">
                        <div class="text-xs text-gray-500 dark:text-gray-400">12월</div>
                        <div class="text-2xl font-bold text-primary">28</div>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-gray-900 dark:text-white">송년회</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">전 직원 참석</p>
                        <div class="flex items-center mt-1 text-xs text-gray-500">
                            <i class="fas fa-glass-cheers mr-1"></i> 오후 6:30
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="w-full mt-4 text-sm text-primary hover:text-primary-hover font-medium">
                전체 일정 보기 <i class="fas fa-calendar-alt ml-1"></i>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/components/ui-components.js' %}"></script>
<script>
    // Update current time
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            weekday: 'long'
        });
        document.getElementById('current-time').textContent = timeString;
    }
    updateTime();
    setInterval(updateTime, 1000);
    
    // Department Performance Chart
    const ctx = document.getElementById('departmentChart').getContext('2d');
    const departmentChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['IT개발', '영업', '마케팅', '인사', '재무', '운영'],
            datasets: [{
                label: '목표 달성률',
                data: [92, 87, 78, 95, 83, 90],
                backgroundColor: '#1443FF',
                borderRadius: 8,
                barThickness: 40
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.parsed.y + '%';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });
    
    // Apply dark mode to chart
    function updateChartTheme() {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const textColor = isDark ? '#E5E7EB' : '#374151';
        const gridColor = isDark ? '#374151' : '#E5E7EB';
        
        departmentChart.options.scales.x.ticks.color = textColor;
        departmentChart.options.scales.y.ticks.color = textColor;
        departmentChart.options.scales.x.grid.color = gridColor;
        departmentChart.options.scales.y.grid.color = gridColor;
        departmentChart.update();
    }
    
    // Watch for theme changes
    const observer = new MutationObserver(updateChartTheme);
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
    updateChartTheme();
    
    // Demo: Show random notifications
    setTimeout(() => {
        showToast('새로운 평가 요청이 있습니다', 'info');
    }, 3000);
</script>
{% endblock %}