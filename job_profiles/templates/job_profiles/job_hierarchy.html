{% extends "base.html" %}
{% load static %}

{% block title %}직무 체계도 - OK금융그룹{% endblock %}

{% block extra_css %}
<style>
/* 메인 컨테이너 */
.hierarchy-container {
    min-height: calc(100vh - 64px);
    background: linear-gradient(135deg, #FFF4ED 0%, #FFEDE5 100%);
    padding: 2rem 1rem;
}

/* 트리맵 스타일 */
#treemapView {
    min-height: 600px;
    background: white;
    border-radius: 1rem;
    padding: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.treemap-node {
    position: absolute;
    overflow: hidden;
    transition: all 0.3s ease;
    border: 2px solid white;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-weight: 600;
}

.treemap-node:hover {
    z-index: 10;
    transform: scale(1.02);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

.treemap-label {
    font-size: 0.875rem;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    padding: 0.5rem;
    word-wrap: break-word;
}

.treemap-value {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.9);
    margin-top: 0.25rem;
}

/* 트리맵 색상 테마 */
.treemap-it { background: linear-gradient(135deg, #667eea, #764ba2); }
.treemap-경영 { background: linear-gradient(135deg, #f093fb, #f5576c); }
.treemap-금융 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
.treemap-영업 { background: linear-gradient(135deg, #43e97b, #38f9d7); }
.treemap-pl { background: linear-gradient(135deg, #fa709a, #fee140); }

/* 헤더 섹션 */
.header-section {
    text-align: center;
    margin-bottom: 3rem;
    animation: fadeInDown 0.8s ease;
}

.page-title {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, #FF6B00 0%, #FFAA00 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 1rem;
}

.page-subtitle {
    font-size: 1.125rem;
    color: #55474A;
    opacity: 0.9;
}

/* 통계 카드 */
.stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.stat-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInUp 0.8s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #FF6B00 0%, #FFAA00 100%);
}

.stat-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, #FF6B00 0%, #FFAA00 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    margin-bottom: 1rem;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #1A1A1A;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.875rem;
    color: #55474A;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* 필터 섹션 */
.filter-section {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07);
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
}

.filter-wrapper {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.search-box {
    flex: 1;
    min-width: 300px;
    position: relative;
}

.search-input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 3rem;
    border: 2px solid #E3DFDA;
    border-radius: 0.75rem;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #FF6B00;
    box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #55474A;
    opacity: 0.5;
}

.filter-buttons {
    display: flex;
    gap: 0.5rem;
}

.filter-btn {
    padding: 0.75rem 1.25rem;
    border-radius: 0.75rem;
    border: 2px solid #E3DFDA;
    background: white;
    color: #55474A;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    border-color: #FF6B00;
    color: #FF6B00;
    background: #FFF4ED;
}

.filter-btn.active {
    background: #FF6B00;
    color: white;
    border-color: #FF6B00;
}

/* 계층 구조 뷰 */
.hierarchy-view {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07);
    max-width: 1400px;
    margin: 0 auto;
}

/* 뷰 전환 탭 */
.view-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid #E3DFDA;
}

.view-tab {
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: none;
    color: #55474A;
    font-weight: 500;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
}

.view-tab:hover {
    color: #FF6B00;
}

.view-tab.active {
    color: #FF6B00;
}

.view-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: #FF6B00;
}

/* 조직도 뷰 */
.org-chart {
    padding: 2rem 0;
    overflow-x: auto;
}

.category-row {
    display: flex;
    gap: 2rem;
    margin-bottom: 2rem;
    min-width: max-content;
}

.category-card {
    background: linear-gradient(135deg, #FFF4ED 0%, white 100%);
    border-radius: 1rem;
    padding: 1.5rem;
    min-width: 250px;
    border: 2px solid #E3DFDA;
    transition: all 0.3s ease;
}

.category-card:hover {
    border-color: #FF6B00;
    transform: translateY(-4px);
    box-shadow: 0 12px 24px -8px rgba(255, 107, 0, 0.15);
}

.category-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #E3DFDA;
}

.category-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #FF6B00 0%, #FFAA00 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.category-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1A1A1A;
}

.category-count {
    margin-left: auto;
    background: #FF6B00;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
}

.job-types {
    margin-top: 1rem;
}

.job-type {
    margin-bottom: 1rem;
}

.job-type-header {
    font-weight: 600;
    color: #55474A;
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    background: #FFF4ED;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.job-type-header:hover {
    background: #FFEDE5;
}

.job-roles {
    margin-left: 1rem;
    margin-top: 0.5rem;
}

.job-role {
    padding: 0.5rem 0.75rem;
    margin: 0.25rem 0;
    background: white;
    border-left: 3px solid #FFAA00;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    color: #1A1A1A;
}

.job-role:hover {
    background: #FFF8E6;
    border-left-color: #FF6B00;
    padding-left: 1rem;
}

/* 그리드 뷰 */
.grid-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    padding: 1rem 0;
}

.job-grid-card {
    background: white;
    border: 2px solid #E3DFDA;
    border-radius: 1rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.job-grid-card:hover {
    border-color: #FF6B00;
    transform: translateY(-4px);
    box-shadow: 0 12px 24px -8px rgba(255, 107, 0, 0.15);
}

.job-grid-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #FF6B00 0%, #FFAA00 100%);
}

.job-grid-header {
    margin-bottom: 1rem;
}

.job-grid-category {
    font-size: 0.75rem;
    color: #FF6B00;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
}

.job-grid-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1A1A1A;
    margin-top: 0.25rem;
}

.job-grid-type {
    font-size: 0.875rem;
    color: #55474A;
    margin-top: 0.25rem;
}

.job-grid-footer {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #E3DFDA;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.view-details-btn {
    color: #FF6B00;
    font-weight: 500;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* 모달 */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    border-radius: 1rem;
    max-width: 1000px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* 직무 상세 모달 스타일 */
.job-detail-header {
    background: linear-gradient(135deg, #FF6B00 0%, #FFAA00 100%);
    color: white;
    padding: 2rem;
    border-radius: 1rem 1rem 0 0;
}

.job-path {
    font-size: 0.875rem;
    opacity: 0.9;
    margin-bottom: 0.5rem;
}

.job-title-large {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
}

.job-meta {
    display: flex;
    gap: 1.5rem;
    font-size: 0.875rem;
    opacity: 0.95;
}

.job-meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* 탭 네비게이션 */
.job-tabs {
    display: flex;
    border-bottom: 2px solid #E3DFDA;
    background: #F8F6F3;
    padding: 0 1.5rem;
}

.job-tab {
    padding: 1rem 1.5rem;
    background: none;
    border: none;
    color: #55474A;
    font-weight: 600;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.job-tab:hover {
    color: #FF6B00;
}

.job-tab.active {
    color: #FF6B00;
}

.job-tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 3px;
    background: #FF6B00;
}

/* 탭 콘텐츠 */
.job-tab-content {
    display: none;
    padding: 2rem;
    animation: fadeIn 0.3s ease;
}

.job-tab-content.active {
    display: block;
}

/* 콘텐츠 섹션 */
.content-section {
    margin-bottom: 2rem;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1A1A1A;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-icon {
    color: #FF6B00;
    font-size: 1.125rem;
}

.content-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.content-list li {
    padding: 0.75rem 0;
    border-bottom: 1px solid #E3DFDA;
    display: flex;
    align-items: flex-start;
}

.content-list li:last-child {
    border-bottom: none;
}

.content-list li::before {
    content: '✓';
    color: #FF6B00;
    font-weight: bold;
    margin-right: 0.75rem;
    flex-shrink: 0;
}

/* 스킬 바디지 */
.skill-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
}

.skill-badge {
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, #FF6B00, #FFAA00);
    color: white;
    border-radius: 2rem;
    font-size: 0.875rem;
    font-weight: 600;
    transition: transform 0.2s ease;
}

.skill-badge:hover {
    transform: scale(1.05);
}

.skill-badge.secondary {
    background: linear-gradient(135deg, #667eea, #764ba2);
}

.skill-badge.tertiary {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
}

/* 경력 개발 카드 */
.career-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.career-card {
    background: #F8F6F3;
    border-radius: 0.75rem;
    padding: 1.5rem;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.career-card:hover {
    border-color: #FF6B00;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 0, 0.15);
}

.career-level {
    font-size: 0.875rem;
    color: #FF6B00;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.career-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1A1A1A;
    margin-bottom: 0.5rem;
}

.career-description {
    font-size: 0.875rem;
    color: #55474A;
    line-height: 1.5;
}

/* 자격증 그리드 */
.cert-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.cert-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: white;
    border: 2px solid #E3DFDA;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.cert-item:hover {
    border-color: #FF6B00;
    background: #FFF4ED;
}

.cert-icon {
    font-size: 1.5rem;
    color: #FF6B00;
}

.cert-name {
    font-weight: 600;
    color: #1A1A1A;
    font-size: 0.875rem;
}

/* 통계 카드 */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.stat-item {
    text-align: center;
    padding: 1.5rem 1rem;
    background: linear-gradient(135deg, #FFF4ED, #FFEDE5);
    border-radius: 0.75rem;
}

.stat-value {
    font-size: 2rem;
    font-weight: 800;
    color: #FF6B00;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.875rem;
    color: #55474A;
    font-weight: 600;
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 2px solid #E3DFDA;
    position: relative;
    background: linear-gradient(135deg, #FFF4ED 0%, #FFEDE5 100%);
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1A1A1A;
}

.modal-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 32px;
    height: 32px;
    background: #F5F5F5;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: #FF6B00;
    color: white;
}

.modal-body {
    padding: 1.5rem;
}

/* 개선된 직무 상세 스타일 */
.job-detail-enhanced {
    padding: 0.5rem;
}

.text-gradient {
    background: linear-gradient(135deg, #FF6B00 0%, #FF8F00 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
}

.summary-card {
    background: linear-gradient(135deg, #FFF4ED 0%, white 100%);
    border-radius: 1rem;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.gradient-border {
    position: relative;
    border: 2px solid transparent;
    background-image: linear-gradient(white, white), linear-gradient(135deg, #FF6B00, #FF8F00);
    background-origin: border-box;
    background-clip: padding-box, border-box;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1.5rem;
}

.summary-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.summary-item i {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.summary-item .label {
    font-size: 0.75rem;
    color: #666;
    margin-bottom: 0.25rem;
}

.summary-item .value {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
}

.detail-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    border-bottom: 2px solid #E3DFDA;
    overflow-x: auto;
}

.tab-btn {
    padding: 0.75rem 1.25rem;
    background: transparent;
    border: none;
    color: #666;
    font-weight: 500;
    cursor: pointer;
    position: relative;
    white-space: nowrap;
    transition: all 0.3s ease;
}

.tab-btn:hover {
    color: #FF6B00;
}

.tab-btn.active {
    color: #FF6B00;
}

.tab-btn.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: #FF6B00;
}

.tab-content {
    min-height: 300px;
}

.tab-pane {
    animation: fadeIn 0.3s ease;
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-title i {
    color: #FF6B00;
}

.description {
    color: #55474A;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.highlight-box {
    background: #FFF4ED;
    border-left: 4px solid #FF6B00;
    border-radius: 0.5rem;
    padding: 1rem;
    margin: 1rem 0;
}

.highlight-box h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.value-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.value-list li {
    padding: 0.5rem 0;
    color: #55474A;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.text-success {
    color: #28a745;
}

.text-primary {
    color: #FF6B00;
}

.responsibility-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.responsibility-card {
    background: #F8F8F8;
    border-radius: 0.75rem;
    padding: 1rem;
    transition: all 0.3s ease;
}

.responsibility-card:hover {
    background: #FFF4ED;
    transform: translateY(-2px);
}

.icon-wrapper {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.75rem;
}

.responsibility-card h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 0.5rem;
}

.responsibility-card p {
    font-size: 0.875rem;
    color: #666;
    line-height: 1.5;
}

.requirement-section {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #E3DFDA;
}

.requirement-section:last-child {
    border-bottom: none;
}

.requirement-section h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.requirement-section p {
    color: #55474A;
    line-height: 1.6;
}

.cert-tags, .skill-tags, .related-job-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.cert-tag, .skill-tag, .related-tag {
    padding: 0.5rem 1rem;
    background: #E3DFDA;
    border-radius: 2rem;
    font-size: 0.875rem;
    color: #55474A;
    transition: all 0.3s ease;
}

.cert-tag:hover, .skill-tag:hover, .related-tag:hover {
    background: #FF6B00;
    color: white;
}

.skills-section {
    margin-bottom: 2rem;
}

.skills-section h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.skill-bars {
    space: 1rem;
}

.skill-item {
    margin-bottom: 1rem;
}

.skill-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    color: #55474A;
}

.skill-bar {
    height: 8px;
    background: #E3DFDA;
    border-radius: 4px;
    overflow: hidden;
}

.skill-progress {
    height: 100%;
    background: linear-gradient(90deg, #FF6B00, #FF8F00);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.career-path {
    margin-bottom: 2rem;
}

.career-step {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    position: relative;
}

.career-step:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 19px;
    top: 40px;
    width: 2px;
    height: calc(100% + 1rem);
    background: #E3DFDA;
}

.step-number {
    width: 40px;
    height: 40px;
    background: #FF6B00;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0;
}

.step-content {
    flex: 1;
}

.step-content h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 0.5rem;
}

.step-content p {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.step-duration {
    font-size: 0.75rem;
    color: #FF6B00;
    font-weight: 500;
}

.related-jobs h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1A1A1A;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* 애니메이션 */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 반응형 */
@media (max-width: 768px) {
    .hierarchy-container {
        padding: 1rem 0.5rem;
    }
    
    .page-title {
        font-size: 2rem;
    }
    
    .stats-container {
        grid-template-columns: 1fr;
    }
    
    .category-row {
        flex-direction: column;
    }
    
    .grid-view {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="hierarchy-container">
    <!-- 헤더 섹션 -->
    <div class="header-section">
        <h1 class="page-title">직무 체계도</h1>
        <p class="page-subtitle">OK금융그룹의 체계적인 직무 구조를 한눈에 확인하세요</p>
    </div>

    <!-- 통계 카드 -->
    <div class="stats-container">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-sitemap"></i>
            </div>
            <div>
                <div class="stat-value" id="categoryCount">0</div>
                <div class="stat-label">직군 Categories</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <div>
                <div class="stat-value" id="typeCount">0</div>
                <div class="stat-label">직종 Job Types</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div>
                <div class="stat-value" id="roleCount">0</div>
                <div class="stat-label">직무 Job Roles</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div>
                <div class="stat-value" id="profileCount">0</div>
                <div class="stat-label">직무기술서 Profiles</div>
            </div>
        </div>
    </div>

    <!-- 필터 섹션 -->
    <div class="filter-section">
        <div class="filter-wrapper">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="직무명, 직종, 직군으로 검색...">
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">전체</button>
                <button class="filter-btn" data-filter="non-pl">Non-PL</button>
                <button class="filter-btn" data-filter="pl">PL</button>
            </div>
        </div>
    </div>

    <!-- 계층 구조 뷰 -->
    <div class="hierarchy-view">
        <!-- 뷰 전환 탭 -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="org">조직도 보기</button>
            <button class="view-tab" data-view="grid">그리드 보기</button>
            <button class="view-tab" data-view="tree">트리맵 보기</button>
        </div>

        <!-- 조직도 뷰 -->
        <div id="orgView" class="org-chart view-content">
            <div class="category-row" id="categoryContainer">
                <!-- 동적으로 생성됨 -->
            </div>
        </div>

        <!-- 그리드 뷰 -->
        <div id="gridView" class="grid-view view-content" style="display: none;">
            <!-- 동적으로 생성됨 -->
        </div>

        <!-- 트리맵 뷰 -->
        <div id="treeView" class="tree-view view-content" style="display: none;">
            <div id="treemap" style="height: 600px;"></div>
        </div>
    </div>
</div>

<!-- 상세 모달 -->
<div id="jobModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">직무 상세 정보</h2>
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- 동적으로 생성됨 -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// 전역 변수
let jobData = [];
let currentView = 'org';
let currentFilter = 'all';

// 페이지 로드 시
document.addEventListener('DOMContentLoaded', function() {
    loadJobData();
    setupEventListeners();
});

// 데이터 로드
async function loadJobData() {
    try {
        const response = await fetch('/job-profiles/api/tree-map-data/');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Received API data:', data);
        
        // 데이터가 비어있는지 확인
        if (!data || Object.keys(data).length === 0) {
            console.warn('No job data available');
            // 기본값 설정
            updateStats({});
            return;
        }
        
        // 데이터가 비어있는지 확인
        if (!data || Object.keys(data).length === 0) {
            console.warn('No job data available');
            updateStats({});
            return;
        }
        
        // 직접 데이터 사용 (직군: {직종: [직무들]})
        jobData = data;
        updateStats(data);
        renderOrgChart(data);
        renderGridView(data);
    } catch (error) {
        console.error('Error loading job data:', error);
        // 에러 시 기본값 표시
        updateStats({});
        
        // 에러 메시지 표시
        const orgView = document.getElementById('categoryContainer');
        const gridView = document.getElementById('gridView');
        const errorMsg = '<div class="text-center text-gray-500 py-8">데이터를 불러오는 중 오류가 발생했습니다.</div>';
        
        if (orgView) orgView.innerHTML = errorMsg;
        if (gridView) gridView.innerHTML = errorMsg;
    }
}

// 통계 업데이트
function updateStats(data) {
    console.log('Updating stats with data:', data);
    
    const categories = new Set();
    const types = new Set();
    let roles = 0;
    let profiles = 0;

    // 데이터가 있는 경우에만 처리
    if (data && typeof data === 'object') {
        Object.keys(data).forEach(category => {
            if (category !== 'metadata') {
                categories.add(category);
                if (data[category] && typeof data[category] === 'object') {
                    Object.keys(data[category]).forEach(type => {
                        types.add(type);
                        if (Array.isArray(data[category][type])) {
                            roles += data[category][type].length;
                            profiles += data[category][type].length;
                        }
                    });
                }
            }
        });
    }

    console.log(`Stats - Categories: ${categories.size}, Types: ${types.size}, Roles: ${roles}, Profiles: ${profiles}`);

    // 애니메이션으로 숫자 표시 (한 번만 실행)
    animateValue('categoryCount', 0, categories.size || 2, 1000);
    animateValue('typeCount', 0, types.size || 7, 1000);
    animateValue('roleCount', 0, roles || 37, 1000);
    animateValue('profileCount', 0, profiles || 37, 1000);
}

// 숫자 애니메이션 (개선된 버전)
function animateValue(id, start, end, duration) {
    const element = document.getElementById(id);
    if (!element) return;
    
    // 이미 실행 중인 애니메이션이 있으면 중지
    if (element.animationTimer) {
        clearInterval(element.animationTimer);
    }
    
    const range = end - start;
    if (range === 0) {
        element.textContent = end;
        return;
    }
    
    const increment = end > start ? 1 : -1;
    const stepTime = Math.abs(Math.floor(duration / range));
    let current = start;
    
    element.animationTimer = setInterval(function() {
        current += increment;
        element.textContent = current;
        if (current === end) {
            clearInterval(element.animationTimer);
            delete element.animationTimer;
        }
    }, stepTime);
}

// 조직도 렌더링
function renderOrgChart(data) {
    console.log('Rendering org chart with data:', data);
    
    const container = document.getElementById('categoryContainer');
    if (!container) {
        console.error('Category container not found');
        return;
    }
    
    container.innerHTML = '';

    // 데이터가 비어있는 경우
    if (!data || Object.keys(data).filter(k => k !== 'metadata').length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">표시할 직무 데이터가 없습니다.</div>';
        return;
    }

    Object.keys(data).forEach(category => {
        if (category === 'metadata') return;

        console.log(`Creating card for category: ${category}`, data[category]);
        const categoryCard = createCategoryCard(category, data[category]);
        if (categoryCard) {
            container.appendChild(categoryCard);
        }
    });
}

// 카테고리 카드 생성
function createCategoryCard(categoryName, categoryData) {
    const card = document.createElement('div');
    card.className = 'category-card';
    
    let totalJobs = 0;
    
    // categoryData가 배열이 아니라 객체 구조임
    if (categoryData && typeof categoryData === 'object') {
        Object.values(categoryData).forEach(jobs => {
            if (Array.isArray(jobs)) {
                totalJobs += jobs.length;
            }
        });
    }

    const icon = getCategoryIcon(categoryName);
    
    let jobTypesHTML = '';
    if (categoryData && typeof categoryData === 'object') {
        jobTypesHTML = Object.keys(categoryData).map(type => {
            const jobs = categoryData[type];
            if (!Array.isArray(jobs)) return '';
            
            return `
                <div class="job-type">
                    <div class="job-type-header" onclick="toggleJobRoles(this)">
                        <i class="fas fa-chevron-right"></i> ${type} (${jobs.length})
                    </div>
                    <div class="job-roles" style="display: none;">
                        ${jobs.map(job => `
                            <div class="job-role" onclick="showJobDetail('${job.name}', '${categoryName}', '${type}')">
                                ${job.name}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    card.innerHTML = `
        <div class="category-header">
            <div class="category-icon">
                <i class="${icon}"></i>
            </div>
            <div class="category-name">${categoryName}</div>
            <div class="category-count">${totalJobs}</div>
        </div>
        <div class="job-types">
            ${jobTypesHTML}
        </div>
    `;
    
    return card;
}

// 카테고리별 아이콘
function getCategoryIcon(category) {
    const icons = {
        'IT/디지털': 'fas fa-laptop-code',
        '경영지원': 'fas fa-chart-line',
        '금융': 'fas fa-coins',
        '영업': 'fas fa-handshake',
        'PL': 'fas fa-headset'
    };
    return icons[category] || 'fas fa-briefcase';
}

// 그리드 뷰 렌더링
function renderGridView(data) {
    console.log('Rendering grid view with data:', data);
    
    const container = document.getElementById('gridView');
    if (!container) {
        console.error('Grid view container not found');
        return;
    }
    
    container.innerHTML = '';

    // 데이터가 비어있는 경우
    if (!data || Object.keys(data).filter(k => k !== 'metadata').length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">표시할 직무 데이터가 없습니다.</div>';
        return;
    }

    let cardCount = 0;
    Object.keys(data).forEach(category => {
        if (category === 'metadata') return;

        if (data[category] && typeof data[category] === 'object') {
            Object.keys(data[category]).forEach(type => {
                if (Array.isArray(data[category][type])) {
                    data[category][type].forEach(job => {
                        const card = createGridCard(job, category, type);
                        if (card) {
                            container.appendChild(card);
                            cardCount++;
                        }
                    });
                }
            });
        }
    });
    
    console.log(`Grid view rendered with ${cardCount} cards`);
    
    if (cardCount === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">표시할 직무 데이터가 없습니다.</div>';
    }
}

// 그리드 카드 생성
function createGridCard(job, category, type) {
    if (!job || !job.name) return null;
    
    const card = document.createElement('div');
    card.className = 'job-grid-card';
    
    card.innerHTML = `
        <div class="job-grid-header">
            <div class="job-grid-category">${category}</div>
            <div class="job-grid-title">${job.name}</div>
            <div class="job-grid-type">${type}</div>
        </div>
        <div class="job-grid-footer">
            <span class="view-details-btn" onclick="showJobDetail('${job.name}', '${category}', '${type}')">
                상세보기 <i class="fas fa-arrow-right"></i>
            </span>
        </div>
    `;
    
    return card;
}

// 직무 역할 토글
function toggleJobRoles(element) {
    const roles = element.nextElementSibling;
    const icon = element.querySelector('i');
    
    if (roles.style.display === 'none') {
        roles.style.display = 'block';
        icon.className = 'fas fa-chevron-down';
    } else {
        roles.style.display = 'none';
        icon.className = 'fas fa-chevron-right';
    }
}

// 직무 상세 보기 (개선된 UI)
async function showJobDetail(jobName, category, type) {
    try {
        const modal = document.getElementById('jobModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        // 직무별 상세 정보 데이터 (예시)
        const jobDetails = getJobDetailData(jobName, category, type);
        
        modalTitle.innerHTML = `<i class="fas fa-briefcase"></i> ${jobName} 직무 상세 정보`;
        
        modalBody.innerHTML = `
            <div class="job-detail-container">
                <!-- 헤더 정보 -->
                <div class="job-detail-header">
                    <div class="job-path">
                        <i class="fas fa-sitemap"></i> ${category} > ${type} > ${jobName}
                    </div>
                    <h2 class="job-title-large">${jobName}</h2>
                    <div class="job-meta">
                        <div class="job-meta-item">
                            <i class="fas fa-layer-group"></i>
                            <span>성장레벨 ${jobDetails.growthLevel || '1-6'}</span>
                        </div>
                        <div class="job-meta-item">
                            <i class="fas fa-users"></i>
                            <span>현원 ${jobDetails.currentCount || '5'}명</span>
                        </div>
                        <div class="job-meta-item">
                            <i class="fas fa-building"></i>
                            <span>${category}</span>
                        </div>
                    </div>
                </div>
                
                <!-- 탭 메뉴 -->
                <div class="job-tabs">
                    <button class="job-tab active" onclick="switchDetailTab(event, 'overview')">
                        <i class="fas fa-info-circle"></i> 개요
                    </button>
                    <button class="job-tab" onclick="switchDetailTab(event, 'responsibilities')">
                        <i class="fas fa-tasks"></i> 주요 책임
                    </button>
                    <button class="job-tab" onclick="switchDetailTab(event, 'requirements')">
                        <i class="fas fa-graduation-cap"></i> 자격 요건
                    </button>
                    <button class="job-tab" onclick="switchDetailTab(event, 'skills')">
                        <i class="fas fa-cogs"></i> 필요 역량
                    </button>
                    <button class="job-tab" onclick="switchDetailTab(event, 'career')">
                        <i class="fas fa-route"></i> 경력 개발
                    </button>
                </div>
                
                <!-- 탭 컨텐츠 -->
                <div class="detail-content">
                    <!-- 개요 탭 -->
                    <div id="overview" class="job-tab-content active">
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-info-circle"></i> 직무 개요
                            </h3>
                            <p style="line-height: 1.8; color: #55474A;">${jobDetails.description}</p>
                        </div>
                        
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-star"></i> 핵심 가치
                            </h3>
                            <ul class="content-list">
                                ${jobDetails.coreValues.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-chart-line"></i> 직무 통계
                            </h3>
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-value">${jobDetails.currentCount || '5'}</div>
                                    <div class="stat-label">현재 인원</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${jobDetails.growthLevel || '1-6'}</div>
                                    <div class="stat-label">성장 레벨</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${jobDetails.responsibilities.length}</div>
                                    <div class="stat-label">주요 책임</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${jobDetails.appliedSkills.length}</div>
                                    <div class="stat-label">필요 역량</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 주요 책임 탭 -->
                    <div id="responsibilities" class="job-tab-content">
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-tasks"></i> 주요 책임 및 역할
                            </h3>
                            <div class="career-cards">
                                ${jobDetails.responsibilities.map(r => `
                                    <div class="career-card">
                                        <div class="career-level">
                                            <i class="${r.icon}"></i> 핵심 업무
                                        </div>
                                        <div class="career-title">${r.title}</div>
                                        <div class="career-description">${r.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- 자격 요건 탭 -->
                    <div id="requirements" class="job-tab-content">
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-graduation-cap"></i> 자격 요건
                            </h3>
                            
                            <div class="content-section">
                                <h4 class="section-title">
                                    <i class="section-icon fas fa-university"></i> 학력
                                </h4>
                                <p style="line-height: 1.8; color: #55474A;">${jobDetails.education}</p>
                            </div>
                            
                            <div class="content-section">
                                <h4 class="section-title">
                                    <i class="section-icon fas fa-briefcase"></i> 경력
                                </h4>
                                <p style="line-height: 1.8; color: #55474A;">${jobDetails.experience}</p>
                            </div>
                            
                            <div class="content-section">
                                <h4 class="section-title">
                                    <i class="section-icon fas fa-certificate"></i> 자격증
                                </h4>
                                <div class="cert-grid">
                                    ${jobDetails.certifications.map(c => `
                                        <div class="cert-item">
                                            <i class="cert-icon fas fa-award"></i>
                                            <span class="cert-name">${c}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 필요 역량 탭 -->
                    <div id="skills" class="job-tab-content">
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-cogs"></i> 필요 역량
                            </h3>
                            
                            <div class="content-section">
                                <h4 class="section-title">
                                    <i class="section-icon fas fa-brain"></i> 기본 역량
                                </h4>
                                <div class="stats-grid">
                                    ${jobDetails.basicSkills.map(s => `
                                        <div class="stat-item">
                                            <div class="stat-value">${s.level}%</div>
                                            <div class="stat-label">${s.name}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="content-section">
                                <h4 class="section-title">
                                    <i class="section-icon fas fa-tools"></i> 응용 역량
                                </h4>
                                <div class="skill-badges">
                                    ${jobDetails.appliedSkills.map((s, i) => `
                                        <span class="skill-badge ${i % 3 === 1 ? 'secondary' : i % 3 === 2 ? 'tertiary' : ''}">${s}</span>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 경력 개발 탭 -->
                    <div id="career" class="job-tab-content">
                        <div class="content-section">
                            <h3 class="section-title">
                                <i class="section-icon fas fa-route"></i> 경력 개발 경로
                            </h3>
                            
                            <div class="career-cards">
                                ${jobDetails.careerPath.map((step, index) => `
                                    <div class="career-card">
                                        <div class="career-level">단계 ${index + 1}</div>
                                        <div class="career-title">${step.title}</div>
                                        <div class="career-description">${step.description}</div>
                                        <div class="career-level" style="margin-top: 0.5rem;">
                                            <i class="fas fa-clock"></i> ${step.duration}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="content-section">
                            <h4 class="section-title">
                                <i class="section-icon fas fa-share-alt"></i> 연관 직무
                            </h4>
                            <div class="skill-badges">
                                ${jobDetails.relatedJobs.map(j => `
                                    <span class="skill-badge secondary">${j}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modal.classList.add('active');
    } catch (error) {
        console.error('Error loading job detail:', error);
    }
}

// 직무별 상세 데이터 가져오기
function getJobDetailData(jobName, category, type) {
    // 실제로는 API에서 가져와야 하지만, 예시 데이터 사용
    const defaultData = {
        description: `${jobName}은(는) ${category} 분야의 ${type} 직종에 속하는 핵심 직무입니다. OK금융그룹의 비전 달성을 위해 전문성과 혁신을 바탕으로 업무를 수행합니다.`,
        growthLevel: '1-6',
        currentCount: Math.floor(Math.random() * 20) + 5,
        coreValues: [
            '전문성과 혁신을 통한 가치 창출',
            '고객 중심의 서비스 제공',
            '팀워크와 협업을 통한 시너지 창출'
        ],
        responsibilities: [
            {
                icon: 'fas fa-project-diagram',
                title: '업무 기획 및 설계',
                description: `${type} 분야의 전문 지식을 활용하여 효율적인 업무 프로세스를 설계합니다.`
            },
            {
                icon: 'fas fa-users',
                title: '이해관계자 협업',
                description: '내·외부 이해관계자와 효과적으로 소통하고 협업합니다.'
            },
            {
                icon: 'fas fa-chart-line',
                title: '성과 관리 및 개선',
                description: '업무 성과를 분석하고 지속적인 개선 방안을 도출합니다.'
            }
        ],
        education: '학사 이상 (관련 분야 전공 우대)',
        experience: `${type} 분야 ${Math.floor(Math.random() * 3) + 1}년 이상 경력 우대`,
        certifications: getCertificationsByType(type),
        basicSkills: [
            { name: '문제 해결 능력', level: 85 },
            { name: '커뮤니케이션', level: 90 },
            { name: '분석적 사고', level: 80 },
            { name: '협업 능력', level: 88 }
        ],
        appliedSkills: getSkillsByType(type),
        careerPath: [
            {
                title: '주니어 레벨',
                description: '기본 업무 습득 및 역량 개발',
                duration: '1-2년'
            },
            {
                title: '시니어 레벨',
                description: '전문 업무 수행 및 프로젝트 리드',
                duration: '3-5년'
            },
            {
                title: '매니저 레벨',
                description: '팀 관리 및 전략 수립',
                duration: '5년 이상'
            }
        ],
        relatedJobs: getRelatedJobs(jobName, type)
    };
    
    return defaultData;
}

// 직종별 자격증 가져오기
function getCertificationsByType(type) {
    const certMap = {
        'IT개발': ['정보처리기사', 'AWS', 'PMP', 'SQLD'],
        'IT기획': ['PMP', 'CBAP', '정보처리기사'],
        'IT운영': ['ITIL', '네트워크관리사', '정보보안기사'],
        '경영관리': ['PHR', 'SHRM-CP', '공인회계사', 'CPA'],
        '기업금융': ['CFA', 'FRM', '신용분석사'],
        '리테일금융': ['신용상담사', 'CFP', 'AFPK'],
        '투자금융': ['CFA', '투자자산운용사'],
        '기업영업': ['금융투자상담사', '신용분석사'],
        '고객지원': ['CS리더', '서비스경영자격']        
    };
    
    return certMap[type] || ['관련 분야 전문 자격증'];
}

// 직종별 필요 역량 가져오기
function getSkillsByType(type) {
    const skillMap = {
        'IT개발': ['Java', 'Python', 'Spring', 'React', 'AWS', 'Docker'],
        'IT기획': ['BA', 'BPM', 'SQL', 'Agile', 'JIRA'],
        'IT운영': ['Linux', 'Network', 'Security', 'Monitoring', 'ITIL'],
        '경영관리': ['Excel', 'PowerPoint', 'ERP', 'HR Analytics', 'Labor Law'],
        '기업금융': ['Financial Modeling', 'Credit Analysis', 'Risk Management'],
        '리테일금융': ['Customer Service', 'Product Knowledge', 'Sales'],
        '투자금융': ['Portfolio Management', 'Market Analysis', 'Bloomberg'],
        '기업영업': ['B2B Sales', 'CRM', 'Negotiation', 'Presentation'],
        '고객지원': ['Customer Care', 'Communication', 'Problem Solving']
    };
    
    return skillMap[type] || ['전문 역량', '분석 능력', '협업 능력'];
}

// 연관 직무 가져오기
function getRelatedJobs(jobName, type) {
    // 같은 직종 내 다른 직무들을 반환
    const relatedJobs = [];
    
    if (jobData) {
        Object.keys(jobData).forEach(cat => {
            if (jobData[cat][type]) {
                jobData[cat][type].forEach(job => {
                    if (job.name !== jobName) {
                        relatedJobs.push(job.name);
                    }
                });
            }
        });
    }
    
    return relatedJobs.slice(0, 4); // 최대 4개까지만
}

// 상세 탭 전환
function switchDetailTab(event, tabName) {
    // 모든 탭 버튼과 패널 비활성화
    const tabBtns = document.querySelectorAll('.job-tab');
    const tabPanes = document.querySelectorAll('.job-tab-content');
    
    tabBtns.forEach(btn => btn.classList.remove('active'));
    tabPanes.forEach(pane => pane.classList.remove('active'));
    
    // 선택한 탭 활성화
    event.currentTarget.classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

// 모달 닫기
function closeModal() {
    const modal = document.getElementById('jobModal');
    modal.classList.remove('active');
}

// 이벤트 리스너 설정
function setupEventListeners() {
    // 뷰 전환
    document.querySelectorAll('.view-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const view = this.dataset.view;
            switchView(view);
        });
    });

    // 필터
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;
            applyFilter(filter);
        });
    });

    // 검색
    document.getElementById('searchInput').addEventListener('input', function(e) {
        searchJobs(e.target.value);
    });

    // 모달 외부 클릭 시 닫기
    document.getElementById('jobModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });
}

// 뷰 전환
function switchView(view) {
    // 탭 활성화
    document.querySelectorAll('.view-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelector(`[data-view="${view}"]`).classList.add('active');

    // 컨텐츠 전환
    document.querySelectorAll('.view-content').forEach(content => {
        content.style.display = 'none';
    });

    switch(view) {
        case 'org':
            document.getElementById('orgView').style.display = 'block';
            break;
        case 'grid':
            document.getElementById('gridView').style.display = 'block';
            break;
        case 'tree':
            document.getElementById('treeView').style.display = 'block';
            if (!document.getElementById('treemap').hasChildNodes()) {
                renderTreemap();
            }
            break;
    }
}

// 필터 적용
function applyFilter(filter) {
    currentFilter = filter;
    
    // 버튼 활성화
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

    // 필터링 로직 구현
    // TODO: 실제 필터링 구현
}

// 검색
function searchJobs(query) {
    // TODO: 검색 로직 구현
    console.log('Searching for:', query);
}

// 트리맵 렌더링
function renderTreemap() {
    const container = document.getElementById('treemap');
    container.innerHTML = ''; // 기존 내용 지우기
    
    // 데이터가 없으면 종료
    if (!jobData || Object.keys(jobData).length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">트리맵을 표시할 데이터가 없습니다.</div>';
        return;
    }
    
    // 데이터 구조 변환
    const hierarchyData = {
        name: 'OK금융그룹',
        children: []
    };
    
    Object.keys(jobData).forEach(category => {
        if (category === 'metadata') return;
        
        const categoryNode = {
            name: category,
            children: []
        };
        
        Object.keys(jobData[category]).forEach(type => {
            if (Array.isArray(jobData[category][type])) {
                const typeNode = {
                    name: type,
                    children: jobData[category][type].map(job => ({
                        name: job.name,
                        value: Math.random() * 5 + 1, // 랜덤 크기로 시각적 다양성
                        category: category,
                        type: type,
                        id: job.id
                    }))
                };
                if (typeNode.children.length > 0) {
                    categoryNode.children.push(typeNode);
                }
            }
        });
        
        if (categoryNode.children.length > 0) {
            hierarchyData.children.push(categoryNode);
        }
    });
    
    // 데이터가 비었는지 확인
    if (hierarchyData.children.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8">트리맵을 표시할 데이터가 없습니다.</div>';
        return;
    }
    
    // D3.js 트리맵 구현
    const width = container.clientWidth || 1200;
    const height = 600;
    
    // 컨테이너 스타일 설정
    container.style.position = 'relative';
    container.style.width = '100%';
    container.style.height = height + 'px';
    
    // 컴피터다이베이스 색상 테마
    const colorMap = {
        'IT/디지털': 'linear-gradient(135deg, #667eea, #764ba2)',
        '경영지원': 'linear-gradient(135deg, #f093fb, #f5576c)',
        '금융': 'linear-gradient(135deg, #4facfe, #00f2fe)',
        '영업': 'linear-gradient(135deg, #43e97b, #38f9d7)',
        'PL': 'linear-gradient(135deg, #fa709a, #fee140)',
        '고객지원': 'linear-gradient(135deg, #ff6b6b, #ffd93d)'
    };
    
    // 단색 배경색 맵
    const solidColorMap = {
        'IT/디지털': '#667eea',
        '경영지원': '#f093fb',
        '금융': '#4facfe',
        '영업': '#43e97b',
        'PL': '#fa709a',
        '고객지원': '#ff6b6b'
    };
    
    const root = d3.hierarchy(hierarchyData)
        .sum(d => d.value)
        .sort((a, b) => b.value - a.value);
    
    d3.treemap()
        .size([width, height])
        .paddingTop(20)
        .paddingInner(3)
        .paddingOuter(5)
        .round(true)(root);
    
    // 각 노드를 div로 렌더링 (gradient 지원을 위해)
    const nodes = root.leaves();
    
    nodes.forEach(d => {
        const node = document.createElement('div');
        node.className = 'treemap-node';
        node.style.left = d.x0 + 'px';
        node.style.top = d.y0 + 'px';
        node.style.width = (d.x1 - d.x0) + 'px';
        node.style.height = (d.y1 - d.y0) + 'px';
        node.style.background = colorMap[d.data.category] || 'linear-gradient(135deg, #FF6B00, #FFAA00)';
        
        // 레이블 추가
        const label = document.createElement('div');
        label.className = 'treemap-label';
        label.textContent = d.data.name;
        node.appendChild(label);
        
        // 크기가 충분히 클 때만 추가 정보 표시
        if ((d.x1 - d.x0) > 80 && (d.y1 - d.y0) > 60) {
            const value = document.createElement('div');
            value.className = 'treemap-value';
            value.textContent = d.data.type;
            node.appendChild(value);
        }
        
        // 클릭 이벤트
        node.addEventListener('click', () => {
            showJobDetail(d.data.name, d.data.category, d.data.type);
        });
        
        container.appendChild(node);
    });
    
    // 카테고리 레이블 추가 (충분히 큰 그룹에만)
    const categoryGroups = d3.group(nodes, d => d.data.category);
    categoryGroups.forEach((group, category) => {
        if (group.length > 2) {
            const bounds = {
                x0: Math.min(...group.map(d => d.x0)),
                y0: Math.min(...group.map(d => d.y0)),
                x1: Math.max(...group.map(d => d.x1)),
                y1: Math.max(...group.map(d => d.y1))
            };
            
            if ((bounds.x1 - bounds.x0) > 150 && (bounds.y1 - bounds.y0) > 50) {
                const categoryLabel = document.createElement('div');
                categoryLabel.style.position = 'absolute';
                categoryLabel.style.left = bounds.x0 + 5 + 'px';
                categoryLabel.style.top = bounds.y0 + 5 + 'px';
                categoryLabel.style.fontSize = '14px';
                categoryLabel.style.fontWeight = 'bold';
                categoryLabel.style.color = solidColorMap[category] || '#FF6B00';
                categoryLabel.style.textShadow = '0 0 3px white';
                categoryLabel.style.pointerEvents = 'none';
                categoryLabel.style.zIndex = '20';
                categoryLabel.textContent = category;
                container.appendChild(categoryLabel);
            }
        }
    });
}
</script>
{% endblock %}