<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ì§ë„ êµ¬í˜„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            padding: 20px;
            background: #1a1f2e;
            color: white;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .pass {
            background: #065f46;
            border: 1px solid #10b981;
        }
        .fail {
            background: #7f1d1d;
            border: 1px solid #ef4444;
        }
        .info {
            background: #1e3a8a;
            border: 1px solid #3b82f6;
        }
        button {
            background: #00d4ff;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        button:hover {
            background: #0099cc;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #00d4ff;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ì°¨ì„¸ëŒ€ ì¡°ì§ë„ í…ŒìŠ¤íŠ¸</h1>
    
    <div id="test-results"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="runAllTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="clearCache()">ìºì‹œ ì´ˆê¸°í™”</button>
        <button onclick="testZoomTransition()">ì¤Œ ì „í™˜ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testExpansion()">í™•ì¥ í…ŒìŠ¤íŠ¸</button>
    </div>
    
    <iframe id="org-chart-frame" src="http://localhost:8002/employees/advanced-org-chart/"></iframe>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }
        
        function clearCache() {
            // ê°•ì œ ìƒˆë¡œê³ ì¹¨
            const iframe = document.getElementById('org-chart-frame');
            iframe.src = iframe.src + '?t=' + Date.now();
            addResult('âœ… ìºì‹œ ì´ˆê¸°í™” ë° í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨', 'pass');
        }
        
        async function runAllTests() {
            results.innerHTML = '';
            addResult('ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            const iframe = document.getElementById('org-chart-frame');
            const iframeWindow = iframe.contentWindow;
            
            // iframe ë¡œë“œ ëŒ€ê¸°
            await new Promise(resolve => {
                if (iframe.contentDocument.readyState === 'complete') {
                    resolve();
                } else {
                    iframe.onload = resolve;
                }
            });
            
            // í…ŒìŠ¤íŠ¸ 1: vertical-cjk í´ë˜ìŠ¤ ì¡´ì¬ í™•ì¸
            const hasCJKClass = iframe.contentDocument.querySelector('.vertical-cjk');
            if (hasCJKClass) {
                addResult('âœ… TEST 1: vertical-cjk í´ë˜ìŠ¤ ì ìš© í™•ì¸', 'pass');
            } else {
                addResult('âŒ TEST 1: vertical-cjk í´ë˜ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
            
            // í…ŒìŠ¤íŠ¸ 2: validateGraph í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
            if (iframeWindow.validateGraph) {
                addResult('âœ… TEST 2: validateGraph í•¨ìˆ˜ ì¡´ì¬ í™•ì¸', 'pass');
                
                // í•¨ìˆ˜ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
                const testEdges = [
                    { source: 'A', target: 'B' },
                    { source: 'A', target: 'C' },
                    { source: 'B', target: 'D' }
                ];
                const validation = iframeWindow.validateGraph(testEdges);
                addResult(`ğŸ“Š TEST 2-1: validateGraph ì‹¤í–‰ ê²°ê³¼ - ì²´ì¸ ê¸¸ì´: ${validation.chainLength}, ìœ íš¨: ${validation.isValid}`, 'info');
            } else {
                addResult('âŒ TEST 2: validateGraph í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
            
            // í…ŒìŠ¤íŠ¸ 3: expandToDepth í•¨ìˆ˜ í™•ì¸
            if (iframeWindow.expandToDepth) {
                addResult('âœ… TEST 3: expandToDepth í•¨ìˆ˜ ì¡´ì¬ í™•ì¸ (BFS ìµœì í™”)', 'pass');
            } else {
                addResult('âŒ TEST 3: expandToDepth í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
            
            // í…ŒìŠ¤íŠ¸ 4: Dense ëª¨ë“œ ì„¤ì • í™•ì¸
            if (iframeWindow.OrgChartState) {
                const config = iframeWindow.CONFIG || {};
                if (config.ZOOM_DENSE_THRESHOLD === 95) {
                    addResult('âœ… TEST 4: Dense ëª¨ë“œ ì„ê³„ê°’ 95% ì„¤ì • í™•ì¸', 'pass');
                } else {
                    addResult(`âš ï¸ TEST 4: Dense ëª¨ë“œ ì„ê³„ê°’ì´ ${config.ZOOM_DENSE_THRESHOLD}%ë¡œ ì„¤ì •ë¨`, 'fail');
                }
                
                const currentZoom = iframeWindow.OrgChartState.zoomLevel;
                const isDense = currentZoom < 95;
                addResult(`ğŸ“Š TEST 4-1: í˜„ì¬ ì¤Œ ë ˆë²¨ ${currentZoom}%, Dense ëª¨ë“œ: ${isDense ? 'í™œì„±' : 'ë¹„í™œì„±'}`, 'info');
            } else {
                addResult('âŒ TEST 4: OrgChartStateë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
            
            // í…ŒìŠ¤íŠ¸ 5: ë…¸ë“œ íƒ€ì… í™•ì¸
            const denseNodes = iframe.contentDocument.querySelectorAll('.dense-node');
            const normalNodes = iframe.contentDocument.querySelectorAll('.org-node:not(.dense-node)');
            addResult(`ğŸ“Š TEST 5: ë…¸ë“œ ìˆ˜ - Dense: ${denseNodes.length}, Normal: ${normalNodes.length}`, 'info');
            
            addResult('âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'pass');
        }
        
        async function testZoomTransition() {
            const iframe = document.getElementById('org-chart-frame');
            const iframeWindow = iframe.contentWindow;
            
            addResult('ğŸ” ì¤Œ ì „í™˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            // ì¤Œ ë ˆë²¨ ë³€ê²½ í…ŒìŠ¤íŠ¸
            if (iframeWindow.updateZoom) {
                // Dense ëª¨ë“œë¡œ ì „í™˜ (90%)
                iframeWindow.updateZoom(90);
                await new Promise(resolve => setTimeout(resolve, 500));
                addResult('ğŸ“Š ì¤Œ 90%ë¡œ ì„¤ì • - Dense ëª¨ë“œ í™œì„±í™” ì˜ˆìƒ', 'info');
                
                // Normal ëª¨ë“œë¡œ ì „í™˜ (100%)
                iframeWindow.updateZoom(100);
                await new Promise(resolve => setTimeout(resolve, 500));
                addResult('ğŸ“Š ì¤Œ 100%ë¡œ ì„¤ì • - Normal ëª¨ë“œ í™œì„±í™” ì˜ˆìƒ', 'info');
                
                addResult('âœ… ì¤Œ ì „í™˜ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'pass');
            } else {
                addResult('âŒ updateZoom í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
        }
        
        async function testExpansion() {
            const iframe = document.getElementById('org-chart-frame');
            const iframeWindow = iframe.contentWindow;
            
            addResult('ğŸ“‚ í™•ì¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            if (iframeWindow.expandToDepth) {
                try {
                    await iframeWindow.expandToDepth('OKê¸ˆìœµê·¸ë£¹', 2);
                    addResult('âœ… ë ˆë²¨ 2ê¹Œì§€ í™•ì¥ ì„±ê³µ', 'pass');
                    
                    await iframeWindow.expandToDepth('OKê¸ˆìœµê·¸ë£¹', 3);
                    addResult('âœ… ë ˆë²¨ 3ê¹Œì§€ í™•ì¥ ì„±ê³µ', 'pass');
                } catch (error) {
                    addResult(`âŒ í™•ì¥ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'fail');
                }
            } else {
                addResult('âŒ expandToDepth í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'fail');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('ğŸ“Œ ì¡°ì§ë„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ!', 'info');
                addResult('ğŸ’¡ ë¸Œë¼ìš°ì € ìºì‹œ ë¬¸ì œê°€ ìˆë‹¤ë©´ Ctrl+F5ë¡œ ê°•ì œ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.', 'info');
            }, 2000);
        });
    </script>
</body>
</html>